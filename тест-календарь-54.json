{"createdAt":"2023-05-08T07:31:07.158Z","updatedAt":"2023-10-21T02:12:10.000Z","id":"54","name":"–¢–µ—Å—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å","active":false,"nodes":[{"parameters":{"updates":["*"],"additionalFields":{}},"id":"0664f54d-6f45-4c3c-98bb-a9f7471e6b8d","name":"Telegram Trigger","type":"n8n-nodes-base.telegramTrigger","typeVersion":1,"position":[-180,1680],"webhookId":"20f7fc01-9174-41ac-a2ca-4ec42fd66490","credentials":{"telegramApi":{"id":"39","name":"–¢–µ—Å—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å"}}},{"parameters":{},"id":"dd742b0d-ab0c-46b9-8e7e-973f61f794c6","name":"event","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[40,1680]},{"parameters":{"jsCode":"// –ö–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü\n\n// –ú–∞—Å—Å–∏–≤ —Å –∏–º–µ–Ω–∞–º–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏\nconst weekdays = [\"–ü–Ω\", \"–í—Ç\", \"–°—Ä\", \"–ß—Ç\", \"–ü—Ç\", \"–°–±\", \"–í—Å\"]\n\n// –û–±—ä–µ–∫—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ –∏ –≥–æ–¥–µ\nconst now = {\n  month: {\n    num: $now.month, // –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞\n    long: $now.monthLong, // –ü–æ–ª–Ω–æ–µ –∏–º—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞\n    starting_week: $now.startOf('month').weekNumber, // –ù–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –º–µ—Å—è—Ü\n    ending_week: $now.endOf('month').weekNumber, // –ù–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –º–µ—Å—è—Ü\n    days_num: $now.daysInMonth // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ\n  },\n  year: $now.year // –¢–µ–∫—É—â–∏–π –≥–æ–¥\n}\n\n// –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö –Ω–µ–¥–µ–ª—å –º–µ—Å—è—Ü–∞\nnow.month.weeks = ( now.month.ending_week - now.month.starting_week ) > 0 ? 1 + now.month.ending_week - now.month.starting_week : 1 + now.month.ending_week\n\n// –°—Ç—Ä–æ–∫–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞\nconst row_month = [\n  {\n    \"text\": `${now.month.long} ${now.year}`, \n    \"callback_data\": \"none\" \n  }\n]\n\n// –ú–∞—Å—Å–∏–≤ –∫–Ω–æ–ø–æ–∫ —Å –¥–Ω—è–º–∏ –Ω–µ–¥–µ–ª–∏\nconst row_weekdays = weekdays\n  .map( e => ({\n    \"text\": e, \n    \"callback_data\": \"none\" \n  }))\n\n// –ú–∞—Å—Å–∏–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤—Å–µ –¥–Ω–∏ –º–µ—Å—è—Ü–∞\nconst calendar = []\n\n// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è\nfor (let i = 0; i < now.month.weeks; i++) {\n  let row = []\n  for (let d = 0; d < 7; d++) {\n    row.push({ \n      \"text\": \" \",\n      \"callback_data\": \"none\"\n    })\n  }\n  calendar.push(row)\n}\n\n// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏, –≤ –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å –º–µ—Å—è—Ü–∞\nlet week_row = 0;\n\n// –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–Ω—è–º–∏ –º–µ—Å—è—Ü–∞\nfor (let i = 0; i < now.month.days_num; i++) {\n  \n  // –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–∞—Ç—ã –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞\n  let d = $now.startOf('month').startOf('day').plus({days: i})\n    \n  let daynum = d.day // –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞\n  let weekday = d.weekday // –ù–æ–º–µ—Ä –¥–Ω—è –Ω–µ–¥–µ–ª–∏ (0 - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 1 - –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –∏ —Ç.–¥.)\n\n  // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å - –≤—Ç–æ—Ä–Ω–∏–∫, –¥–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–æ–∫ üîí –≤ —è—á–µ–π–∫—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º callback_data \"closed\"\n  if (weekday == 2) {\n    calendar[week_row][weekday - 1].text = \"üîí\"\n    calendar[week_row][weekday - 1].callback_data = \"closed\"\n  } else {\n    // –ò–Ω–∞—á–µ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞ –≤ —è—á–µ–π–∫—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π callback_data\n    calendar[week_row][weekday - 1].text = daynum.toString()\n    calendar[week_row][weekday - 1].callback_data = \"date_\" + d.toMillis().toString()\n  }\n\n  // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è\n  if (weekday == 7) {\n    week_row++\n  }\n}\n\n// –ú–∞—Å—Å–∏–≤ –∫–Ω–æ–ø–æ–∫ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –º–µ—Å—è—Ü–∞–º\nconst row_navigation = [\n  { \n    \"text\": \"‚è™\", \n    \"callback_data\": `month_${now.month.num}_prev` \n  },\n  {\n    \"text\": \"üìÖ\",\n    \"callback_data\": \"none\"\n  },\n  { \n    \"text\": \"‚è©\", \n    \"callback_data\": `month_${now.month.num}_next`\n  }\n] \n\n// –û–±—ä–µ–∫—Ç reply_markup, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è\nconst reply_markup = { \n  \"inline_keyboard\" : [\n    row_month,\n    row_weekdays,\n    ...calendar,\n    row_navigation\n  ]  \n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π reply_markup –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞\nreturn [{ \n  reply_markup\n}];"},"id":"6ff0eff8-7521-420b-bdc9-3041ba820f13","name":"calendar_keyboard","type":"n8n-nodes-base.code","typeVersion":1,"position":[520,1440]},{"parameters":{"method":"POST","url":"=https://api.telegram.org/bot6279803331:AAFQW47XVabK4fTgxBpcX7v9kE_ZUsCsTiI/editMessageReplyMarkup","sendBody":true,"bodyParameters":{"parameters":[{"name":"chat_id","value":"={{  $('event').first().json[\"callback_query\"][\"from\"][\"id\"]  }}"},{"name":"reply_markup","value":"={{ $json.reply_markup }}"},{"name":"message_id","value":"={{  $('event').first().json[\"callback_query\"][\"message\"][\"message_id\"]  }}"}]},"options":{}},"id":"03f7d36a-5ac5-4859-8831-6be5357f00f0","name":" another_month","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[940,2200],"alwaysOutputData":false},{"parameters":{"method":"POST","url":"=https://api.telegram.org/bot6279803331:AAFQW47XVabK4fTgxBpcX7v9kE_ZUsCsTiI/sendMessage","sendBody":true,"bodyParameters":{"parameters":[{"name":"chat_id","value":"={{  $('event').first().json[\"message\"][\"from\"][\"id\"]  }}"},{"name":"text","value":"=–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É"},{"name":"reply_markup","value":"={{ $json.reply_markup }}"}]},"options":{}},"id":"d036e61a-6bae-4915-b7db-984256e4b3e0","name":"calendar_msg","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[940,1440],"alwaysOutputData":false},{"parameters":{"conditions":{"boolean":[{"value1":"={{  \"message\" in $json  }}","value2":true}]}},"id":"eb192406-6cff-4a59-8882-4b38f15c4275","name":"if_message","type":"n8n-nodes-base.if","typeVersion":1,"position":[260,1680]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.message.text }}","value2":"/calendar"}]}},"id":"9d8f1922-b9af-424c-8b0d-20823958ea53","name":"if_calendar","type":"n8n-nodes-base.if","typeVersion":1,"position":[520,1680]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.message.text }}","value2":"/start"}]}},"id":"f577b236-05a7-4be7-ba8d-d61fefc45a77","name":"if_start","type":"n8n-nodes-base.if","typeVersion":1,"position":[740,1680]},{"parameters":{"url":"=https://api.telegram.org/bot6279803331:AAFQW47XVabK4fTgxBpcX7v9kE_ZUsCsTiI/sendMessage","sendBody":true,"bodyParameters":{"parameters":[{"name":"chat_id","value":"={{ $json[\"message\"][\"from\"][\"id\"] }}"},{"name":"text","value":"Hello"}]},"options":{}},"id":"cd6a3dd7-5f7d-401c-848e-60c49ab4121a","name":"start_msg","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[940,1680]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json[\"callback_query\"][\"data\"] }}","value2":"none"},{"value1":"={{ $json[\"callback_query\"][\"data\"] }}","value2":"closed"}]},"combineOperation":"any"},"id":"a9a613f4-1de1-4984-b648-7bb19a73e704","name":"callback_none","type":"n8n-nodes-base.if","typeVersion":1,"position":[260,1940]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json[\"callback_query\"][\"data\"] }}","operation":"startsWith","value2":"month_"}]}},"id":"b520c3f3-1487-4e3c-9bc2-fde5a339a50b","name":"callback_month","type":"n8n-nodes-base.if","typeVersion":1,"position":[260,2200]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json[\"callback_query\"][\"data\"] }}","operation":"startsWith","value2":"date_"}]}},"id":"cfa98c39-5208-4171-8e43-3691e40fe89d","name":"callback_day","type":"n8n-nodes-base.if","typeVersion":1,"position":[260,2460]},{"parameters":{"jsCode":"// –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\nconst data = $('event').first().json; // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON\nconst cq = data.callback_query; // –ü–æ–ª—É—á–∞–µ–º callback_query –∏–∑ –¥–∞–Ω–Ω—ã—Ö\nconst cd = cq.data; // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–µ data –∏–∑ callback_query\n\n// –ü–æ–ª—É—á–∞–µ–º –º–µ—Å—è—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è\nconst old_month = cd.split(\"_\")[1]; \nconst new_month = cd.split(\"_\")[2];\n\n// –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–π –º–µ—Å—è—Ü –Ω–∞ –æ—Å–Ω–æ–≤–µ old_month –∏ new_month\nconst new_now = \n  new_month === \"prev\" ? \n  $now.set({month: old_month}).minus({months: 1}) :\n  $now.set({month: old_month}).plus({months: 1});\n\n// –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏\nconst weekdays = [\"–ü–Ω\", \"–í—Ç\", \"–°—Ä\", \"–ß—Ç\", \"–ü—Ç\", \"–°–±\", \"–í—Å\"];\n\n// –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç now, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ –∏ –≥–æ–¥–µ\nconst now = {\n  month: {\n    num: new_now.month, // –ù–æ–º–µ—Ä –º–µ—Å—è—Ü–∞ (1-12)\n    long: new_now.monthLong, // –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞ (–Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ)\n    starting_week: new_now.startOf('month').weekNumber, // –ù–æ–º–µ—Ä –Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–µ–¥–µ–ª–∏ –º–µ—Å—è—Ü–∞\n    ending_week: new_now.endOf('month').weekNumber, // –ù–æ–º–µ—Ä –∫–æ–Ω–µ—á–Ω–æ–π –Ω–µ–¥–µ–ª–∏ –º–µ—Å—è—Ü–∞\n    days_num: new_now.daysInMonth // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ\n  },\n  year: new_now.year // –ì–æ–¥\n};\n\n// –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–¥–µ–ª—å –≤ –º–µ—Å—è—Ü–µ\nnow.month.weeks = ( now.month.ending_week - now.month.starting_week ) > 0 ? 1 + now.month.ending_week - now.month.starting_week : 1 + now.month.ending_week;\n\n// –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫—É, —Å–æ–¥–µ—Ä–∂–∞—â—É—é –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞\nnow.month_year_long = `${now.month.long} ${now.year}`;\n\n// –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—ã–π —Ä—è–¥ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞\nconst row_month = [\n  {\n    \"text\": now.month_year_long, \n    \"callback_data\": \"none\" \n  }\n];\n\n// –°–æ–∑–¥–∞–µ–º –≤—Ç–æ—Ä–æ–π —Ä—è–¥ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏\nconst row_weekdays = weekdays\n  .map( e => ({\n    \"text\": e, \n    \"callback_data\": \"none\" \n  }));\n\n// –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö —è—á–µ–µ–∫ –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–µ–¥–µ–ª–∏ –º–µ—Å—è—Ü–∞\nconst calendar = [];\nfor (let i = 0; i < now.month.weeks; i++) {\n  let row = []\n  for (let d = 0; d < 7; d++) {\n    row.push({ \n      \"text\": \" \",\n      \"callback_data\": \"none\"\n    })\n  }\n  calendar.push(row)\n}\n\n// –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ —è—á–µ–π–∫–∏ –Ω–æ–º–µ—Ä–∞–º–∏ –¥–Ω–µ–π –º–µ—Å—è—Ü–∞\nlet week_row = 0;\nfor (let i = 0; i < now.month.days_num; i++) {\n  let d = new_now.startOf('month').startOf('day').plus({days: i})\n  let daynum = d.day\n  let weekday = d.weekday\n\n  calendar[week_row][weekday - 1].text = daynum.toString()\n  calendar[week_row][weekday - 1].callback_data = \"date_\" + d.toMillis().toString()\n\n  if (weekday == 7) {\n    week_row++\n  }\n}\n\n// –°–æ–∑–¥–∞–µ–º —Ç—Ä–µ—Ç–∏–π —Ä—è–¥ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É –º–µ—Å—è—Ü–∞–º–∏\nconst row_navigation = [\n  { \n    \"text\": \"‚è™\", \n    \"callback_data\": `month_${now.month.num}_prev` \n  },\n  {\n    \"text\": \"üìÖ\",\n    \"callback_data\": \"none\"\n  },\n  { \n    \"text\": \"‚è©\", \n    \"callback_data\": `month_${now.month.num}_next`\n  }\n] \n\n// –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç reply_markup, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤—Å–µ —Ä—è–¥—ã –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è\nconst reply_markup = { \n  \"inline_keyboard\" : [\n    row_month,\n    row_weekdays,\n    ...calendar,\n    row_navigation\n  ]  \n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö reply_markup –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–æ–ª—è reply_markup\nreturn [{ \n  reply_markup\n}];"},"id":"26952142-4b19-43c6-b087-1b457cc68c7e","name":"month_keyboard","type":"n8n-nodes-base.code","typeVersion":1,"position":[520,2200]},{"parameters":{"resource":"callback","queryId":"={{   $('event').first().json[\"callback_query\"][\"id\"]   }}","additionalFields":{"show_alert":true,"text":"={{  DateTime.fromMillis( Number($('event').first().json[\"callback_query\"][\"data\"].split(\"_\")[1]) ).toFormat('dd-LL-yyyy') }}"}},"id":"105da8cc-d49a-4d3f-93bf-59d79c463bee","name":"show_date","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[940,2460],"credentials":{"telegramApi":{"id":"39","name":"–¢–µ—Å—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å"}}},{"parameters":{"resource":"callback","queryId":"={{  $('event').first().json[\"callback_query\"][\"id\"]  }}","additionalFields":{}},"id":"fe0e492b-9a9f-4d71-96fb-67eba28cff0b","name":"answer_query","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[940,1960],"credentials":{"telegramApi":{"id":"39","name":"–¢–µ—Å—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å"}}},{"parameters":{"jsCode":"// –ö–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü\n\n// –ú–∞—Å—Å–∏–≤ —Å –∏–º–µ–Ω–∞–º–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏\nconst weekdays = [\"–ü–Ω\", \"–í—Ç\", \"–°—Ä\", \"–ß—Ç\", \"–ü—Ç\", \"–°–±\", \"–í—Å\"]\n\n// –û–±—ä–µ–∫—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ –∏ –≥–æ–¥–µ\nconst now = {\n  month: {\n    num: $now.month, // –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞\n    long: $now.monthLong, // –ü–æ–ª–Ω–æ–µ –∏–º—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞\n    starting_week: $now.startOf('month').weekNumber, // –ù–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –º–µ—Å—è—Ü\n    ending_week: $now.endOf('month').weekNumber, // –ù–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –º–µ—Å—è—Ü\n    days_num: $now.daysInMonth // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ\n  },\n  year: $now.year // –¢–µ–∫—É—â–∏–π –≥–æ–¥\n}\n\n// –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö –Ω–µ–¥–µ–ª—å –º–µ—Å—è—Ü–∞\nnow.month.weeks = ( now.month.ending_week - now.month.starting_week ) > 0 ? 1 + now.month.ending_week - now.month.starting_week : 1 + now.month.ending_week\n\n// –°—Ç—Ä–æ–∫–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞\nconst row_month = [\n  {\n    \"text\": `${now.month.long} ${now.year}`, \n    \"callback_data\": \"none\" \n  }\n]\n\n// –ú–∞—Å—Å–∏–≤ –∫–Ω–æ–ø–æ–∫ —Å –¥–Ω—è–º–∏ –Ω–µ–¥–µ–ª–∏\nconst row_weekdays = weekdays\n  .map( e => ({\n    \"text\": e, \n    \"callback_data\": \"none\" \n  }))\n\n// –ú–∞—Å—Å–∏–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤—Å–µ –¥–Ω–∏ –º–µ—Å—è—Ü–∞\nconst calendar = []\n\n// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è\nfor (let i = 0; i < now.month.weeks; i++) {\n  let row = []\n  for (let d = 0; d < 7; d++) {\n    row.push({ \n      \"text\": \" \",\n      \"callback_data\": \"none\"\n    })\n  }\n  calendar.push(row)\n}\n\n// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏, –≤ –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å –º–µ—Å—è—Ü–∞\nlet week_row = 0;\n\n// –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–Ω—è–º–∏ –º–µ—Å—è—Ü–∞\nfor (let i = 0; i < now.month.days_num; i++) {\n  \n  // –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–∞—Ç—ã –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞\n  let d = $now.startOf('month').startOf('day').plus({days: i})\n    \n  let daynum = d.day // –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞\n  let weekday = d.weekday // –ù–æ–º–µ—Ä –¥–Ω—è –Ω–µ–¥–µ–ª–∏ (0 - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 1 - –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –∏ —Ç.–¥.)\n\n  // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å - –≤—Ç–æ—Ä–Ω–∏–∫, –¥–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–æ–∫ üîí –≤ —è—á–µ–π–∫—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º callback_data \"closed\"\n  if (weekday == 2) {\n    calendar[week_row][weekday - 1].text = \"üîí\"\n    calendar[week_row][weekday - 1].callback_data = \"closed\"\n  } else {\n    // –ò–Ω–∞—á–µ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞ –≤ —è—á–µ–π–∫—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π callback_data\n    calendar[week_row][weekday - 1].text = daynum.toString()\n    calendar[week_row][weekday - 1].callback_data = \"date_\" + d.toMillis().toString()\n  }\n\n  // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è\n  if (weekday == 7) {\n    week_row++\n  }\n}\n\n// –ú–∞—Å—Å–∏–≤ –∫–Ω–æ–ø–æ–∫ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –º–µ—Å—è—Ü–∞–º\nconst row_navigation = [\n  { \n    \"text\": \"‚è™\", \n    \"callback_data\": `month_${now.month.num}_prev` \n  },\n  {\n    \"text\": \"üìÖ\",\n    \"callback_data\": \"none\"\n  },\n  { \n    \"text\": \"‚è©\", \n    \"callback_data\": `month_${now.month.num}_next`\n  }\n] \n\n// –û–±—ä–µ–∫—Ç reply_markup, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è\nconst reply_markup = { \n  \"inline_keyboard\" : [\n    row_month,\n    row_weekdays,\n    ...calendar,\n    row_navigation\n  ]  \n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π reply_markup –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞\nreturn [{ \n  reply_markup\n}];"},"id":"6690a20c-c6f8-4306-b4a1-ba24295bd8ba","name":"calendar_keyboard1","type":"n8n-nodes-base.code","typeVersion":1,"position":[160,1440]},{"parameters":{"jsCode":"// –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\nconst data = $('event').first().json; // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON\nconst cq = data.callback_query; // –ü–æ–ª—É—á–∞–µ–º callback_query –∏–∑ –¥–∞–Ω–Ω—ã—Ö\nconst cd = cq.data; // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–µ data –∏–∑ callback_query\n\n// –ü–æ–ª—É—á–∞–µ–º –º–µ—Å—è—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è\nconst old_month = cd.split(\"_\")[1]; \nconst new_month = cd.split(\"_\")[2];\n\n// –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–π –º–µ—Å—è—Ü –Ω–∞ –æ—Å–Ω–æ–≤–µ old_month –∏ new_month\nconst new_now = \n  new_month === \"prev\" ? \n  $now.set({month: old_month}).minus({months: 1}) :\n  $now.set({month: old_month}).plus({months: 1});\n\n// –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏\nconst weekdays = [\"–ü–Ω\", \"–í—Ç\", \"–°—Ä\", \"–ß—Ç\", \"–ü—Ç\", \"–°–±\", \"–í—Å\"];\n\n// –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç now, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ –∏ –≥–æ–¥–µ\nconst now = {\n  month: {\n    num: new_now.month, // –ù–æ–º–µ—Ä –º–µ—Å—è—Ü–∞ (1-12)\n    long: new_now.monthLong, // –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞ (–Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ)\n    starting_week: new_now.startOf('month').weekNumber, // –ù–æ–º–µ—Ä –Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–µ–¥–µ–ª–∏ –º–µ—Å—è—Ü–∞\n    ending_week: new_now.endOf('month').weekNumber, // –ù–æ–º–µ—Ä –∫–æ–Ω–µ—á–Ω–æ–π –Ω–µ–¥–µ–ª–∏ –º–µ—Å—è—Ü–∞\n    days_num: new_now.daysInMonth // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ\n  },\n  year: new_now.year // –ì–æ–¥\n};\n\n// –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–¥–µ–ª—å –≤ –º–µ—Å—è—Ü–µ\nnow.month.weeks = ( now.month.ending_week - now.month.starting_week ) > 0 ? 1 + now.month.ending_week - now.month.starting_week : 1 + now.month.ending_week;\n\n// –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫—É, —Å–æ–¥–µ—Ä–∂–∞—â—É—é –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞\nnow.month_year_long = `${now.month.long} ${now.year}`;\n\n// –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—ã–π —Ä—è–¥ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞\nconst row_month = [\n  {\n    \"text\": now.month_year_long, \n    \"callback_data\": \"none\" \n  }\n];\n\n// –°–æ–∑–¥–∞–µ–º –≤—Ç–æ—Ä–æ–π —Ä—è–¥ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏\nconst row_weekdays = weekdays\n  .map( e => ({\n    \"text\": e, \n    \"callback_data\": \"none\" \n  }));\n\n// –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö —è—á–µ–µ–∫ –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–µ–¥–µ–ª–∏ –º–µ—Å—è—Ü–∞\nconst calendar = [];\nfor (let i = 0; i < now.month.weeks; i++) {\n  let row = []\n  for (let d = 0; d < 7; d++) {\n    row.push({ \n      \"text\": \" \",\n      \"callback_data\": \"none\"\n    })\n  }\n  calendar.push(row)\n}\n\n// –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ —è—á–µ–π–∫–∏ –Ω–æ–º–µ—Ä–∞–º–∏ –¥–Ω–µ–π –º–µ—Å—è—Ü–∞\nlet week_row = 0;\nfor (let i = 0; i < now.month.days_num; i++) {\n  let d = new_now.startOf('month').startOf('day').plus({days: i})\n  let daynum = d.day\n  let weekday = d.weekday\n\n  calendar[week_row][weekday - 1].text = daynum.toString()\n  calendar[week_row][weekday - 1].callback_data = \"date_\" + d.toMillis().toString()\n\n  if (weekday == 7) {\n    week_row++\n  }\n}\n\n// –°–æ–∑–¥–∞–µ–º —Ç—Ä–µ—Ç–∏–π —Ä—è–¥ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É –º–µ—Å—è—Ü–∞–º–∏\nconst row_navigation = [\n  { \n    \"text\": \"‚è™\", \n    \"callback_data\": `month_${now.month.num}_prev` \n  },\n  {\n    \"text\": \"üìÖ\",\n    \"callback_data\": \"none\"\n  },\n  { \n    \"text\": \"‚è©\", \n    \"callback_data\": `month_${now.month.num}_next`\n  }\n] \n\n// –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç reply_markup, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤—Å–µ —Ä—è–¥—ã –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è\nconst reply_markup = { \n  \"inline_keyboard\" : [\n    row_month,\n    row_weekdays,\n    ...calendar,\n    row_navigation\n  ]  \n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö reply_markup –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–æ–ª—è reply_markup\nreturn [{ \n  reply_markup\n}];"},"id":"53269ed4-2603-47e8-97a4-ba100dc13234","name":"month_keyboard1","type":"n8n-nodes-base.code","typeVersion":1,"position":[520,2340]}],"connections":{"Telegram Trigger":{"main":[[{"node":"event","type":"main","index":0}]]},"event":{"main":[[{"node":"if_message","type":"main","index":0}]]},"calendar_keyboard":{"main":[[{"node":"calendar_msg","type":"main","index":0}]]}," another_month":{"main":[[{"node":"answer_query","type":"main","index":0}]]},"if_message":{"main":[[{"node":"if_calendar","type":"main","index":0}],[{"node":"callback_none","type":"main","index":0}]]},"if_calendar":{"main":[[{"node":"calendar_keyboard","type":"main","index":0}],[{"node":"if_start","type":"main","index":0}]]},"if_start":{"main":[[{"node":"start_msg","type":"main","index":0}]]},"callback_none":{"main":[[{"node":"answer_query","type":"main","index":0}],[{"node":"callback_month","type":"main","index":0}]]},"callback_month":{"main":[[{"node":"month_keyboard","type":"main","index":0}],[{"node":"callback_day","type":"main","index":0}]]},"callback_day":{"main":[[{"node":"show_date","type":"main","index":0}]]},"month_keyboard":{"main":[[{"node":" another_month","type":"main","index":0}]]}},"settings":{},"staticData":null,"meta":null,"pinData":{},"versionId":"696d4af8-1faf-426a-8c6f-229deee637c1","triggerCount":1,"tags":[]}