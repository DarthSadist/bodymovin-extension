{"createdAt":"2023-04-24T22:08:07.967Z","updatedAt":"2023-05-03T22:47:44.000Z","id":"41","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥(–Ω–∞–ø–æ–º–∏–Ω–∞–∏–µ –∑–∞ –¥–µ–Ω—å –¥–æ –≤–∏–∑–∏—Ç–∞)","active":true,"nodes":[{"parameters":{"rule":{"interval":[{"triggerAtHour":10}]}},"id":"8cee6e6a-a883-48be-b28d-2ab85884c00f","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1,"position":[400,500]},{"parameters":{"jsCode":"const today = new Date();\nconst tomorrow = new Date(today);\ntomorrow.setDate(today.getDate() + 1);\n\nconst formatDate = (date) => {\n  const year = date.getFullYear().toString();\n  let month = (date.getMonth() + 1).toString();\n  let day = date.getDate().toString();\n  if (month.length < 2) {\n    month = `0${month}`;\n  }\n  if (day.length < 2) {\n    day = `0${day}`;\n  }\n  return `${day}.${month}.${year}`;\n};\n\nconst currentDate = formatDate(today);\nconst tomorrowDate = formatDate(tomorrow);\n\nreturn [\n  {\n    json: {\n      current_date: currentDate,\n      tomorrow_date: tomorrowDate\n    }\n  }\n];"},"id":"3944bb4f-8754-49af-ad53-b542bf97fb82","name":"–ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞—Ç—ã","type":"n8n-nodes-base.code","typeVersion":1,"position":[540,500]},{"parameters":{"documentId":{"__rl":true,"value":"1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE","mode":"list","cachedResultName":"–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤(–º–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥)","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤(–º–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥)","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞","lookupValue":"={{ $json[\"tomorrow_date\"] }}"}]},"options":{"returnAllMatches":"returnAllMatches"}},"id":"7a5a163b-aa14-484e-9c06-c0a92bbe1a71","name":"Google Sheets","type":"n8n-nodes-base.googleSheets","typeVersion":3,"position":[680,500],"credentials":{"googleSheetsOAuth2Api":{"id":"27","name":"Google Sheets account"}}},{"parameters":{"conditions":{"string":[{"value1":"={{ $json[\"–í–æ—Ä–æ–Ω–∫–∞\"] }}","value2":"4. –º–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω"}]}},"id":"833902b8-fdd0-4d14-ad8f-67c932fa08ad","name":"IF1","type":"n8n-nodes-base.if","typeVersion":1,"position":[820,500]},{"parameters":{"chatId":"={{ $node[\"Google Sheets\"].json[\"Telegram ID\"] }}","text":"=<b>–ù–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –∑–∞–≤—Ç—Ä–∞ –∫ –í–∞–º –ø—Ä–∏–¥–µ—Ç –º–∞—Å—Ç–µ—Ä!</b>\n\n{{ $json[\"aggregatedText\"] }}\n\nüì¢<b>–í–ê–ñ–ù–û</b>: <i>—á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É \"–£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ\" ! –ü–µ—Ä–µ–π—Ç–∏ –≤ –õ–∏—á–Ω—ã–π –∫–∞–±–µ–Ω–µ—Ç –º–æ–∂–Ω–æ –ø–æ –∫–Ω–æ–ø–∫–µ \"–ú–µ–Ω—é\", —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–π –≤ –Ω–∏–∂–Ω–µ–º –ª–µ–≤–æ–º —É–≥–ª—É.</i>","additionalFields":{"parse_mode":"HTML"}},"id":"ceef0bf9-2833-47d3-9158-2fe4361bb4c0","name":"—Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1140,300],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"jsCode":"let aggregatedText = '';\n\nitems.forEach(item => {\n  const rowNumber = item.json.row_number;\n  const specialist = item.json['–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'];\n  const task = item.json['–ó–∞–¥–∞—á–∞'];\n  const date = item.json['–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞'];\n  const time = item.json['–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞'];\n  let funnel = item.json['–í–æ—Ä–æ–Ω–∫–∞'];\n  const masterAppointed = item.json['–ú–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω'];\n\n  if (funnel.startsWith('4.')) {\n    funnel = 'üìù –º–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω';\n  } else if (funnel.startsWith('5.')) {\n    funnel = 'üö∂ 1—ã–π –≤–∏–∑–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω';\n  } else if (funnel.startsWith('6.')) {\n    funnel = 'üí≥ —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É';\n  } else if (funnel.startsWith('7.')) {\n    funnel = '‚úÖ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª';\n  } else if (funnel.startsWith('10.')) {\n    funnel = 'ü™õ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É';\n  }\n\n  aggregatedText += `‚û§ <b>–ó–∞—è–≤–∫–∞ ‚Ññ${rowNumber}</b>\\n\\n`;\n  aggregatedText += `‚Ä¢ üë§<b>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</b> <i>${specialist}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÉ<b>–ó–∞–¥–∞—á–∞:</b> <i>${task}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÖ<b>–î–∞—Ç–∞:</b> <i>${date}</i>\\n`;\n  aggregatedText += `‚Ä¢ üï∞<b>–í—Ä–µ–º—è:</b> <i>${time}</i>\\n`;\n  aggregatedText += `‚Ä¢ üõ† <b>–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏:</b> <i>${funnel}</i>\\n`;\n\n  if (masterAppointed) {\n    aggregatedText += `‚Ä¢ üß∞ <b>–í–∞–º –Ω–∞–∑–Ω–∞—á–µ–Ω –º–∞—Å—Ç–µ—Ä: </b><i>üëã ${masterAppointed}</i>\\n`\n  }\n\n  aggregatedText += '\\n';\n});\n\nreturn [{json: {aggregatedText: aggregatedText}}];"},"id":"bcbe365d-6f6e-45b0-bef6-79f50fc7ab68","name":"—Ç–µ–∫—Å—Ç –∫–ª–∏–µ–Ω—Ç","type":"n8n-nodes-base.code","typeVersion":1,"position":[980,300]},{"parameters":{"chatId":"={{ $node[\"Google Sheets\"].json[\"TG ID\"] }}","text":"=<b>–ù–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ —É –í–∞—Å –Ω–∞–∑–Ω–∞—á–µ–Ω –ø–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç –∫ –∫–ª–∏–µ–Ω—Ç—É!</b>\n\n{{ $node[\"—Ç–µ–∫—Å—Ç –º–∞—Å—Ç–µ—Ä\"].json[\"aggregatedText\"] }}\n\n<b>–¢–∞–∫ –∂–µ –Ω–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –ø–æ –ø—Ä–∏–µ–∑–¥—É –∫ –∫–ª–∏–µ–Ω—Ç—É –í–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–∏—Ç—å –æ–ø—Ä–æ—Å–Ω–∏–∫.–û–ø—Ä–æ—Å–Ω–∏–∫ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è \"–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç\" -> \"—Ç–µ–∫—É—â–∏–µ –∑–∞–∫–∞–∑—ã\"</b> üìù\n\nüì¢<b>–í–ê–ñ–ù–û</b>: <i>—á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É \"–£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ\" ! –ü–µ—Ä–µ–π—Ç–∏ –≤ –õ–∏—á–Ω—ã–π –∫–∞–±–µ–Ω–µ—Ç –º–æ–∂–Ω–æ –ø–æ –∫–Ω–æ–ø–∫–µ \"–ú–µ–Ω—é\", —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–π –≤ –Ω–∏–∂–Ω–µ–º –ª–µ–≤–æ–º —É–≥–ª—É.</i>","additionalFields":{"parse_mode":"HTML"}},"id":"0a88c8e8-f715-4ff0-9fa1-82bfbf103668","name":"—Å–æ–æ–±—â–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä—É","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1140,500],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"jsCode":"let aggregatedText = '';\n\nitems.forEach(item => {\n  const rowNumber = item.json.row_number;\n  const specialist = item.json['–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'];\n  const task = item.json['–ó–∞–¥–∞—á–∞'];\n  const date = item.json['–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞'];\n  const time = item.json['–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞'];\n  const address = item.json['–ê–¥—Ä–µ—Å'];\n  const telephone = item.json['–¢–µ–ª–µ—Ñ–æ–Ω'];\n\n  aggregatedText += `‚û§ <b>–ó–∞—è–≤–∫–∞ ‚Ññ${rowNumber}</b>\\n\\n`;\n  aggregatedText += `‚Ä¢ üë§<b>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</b> <i>${specialist}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÉ<b>–ó–∞–¥–∞—á–∞:</b> <i>${task}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÖ<b>–î–∞—Ç–∞:</b> <i>${date}</i>\\n`;\n  aggregatedText += `‚Ä¢ üï∞<b>–í—Ä–µ–º—è:</b> <i>${time}</i>\\n`;\n  aggregatedText += `‚Ä¢ üè†<b>–ê–¥—Ä–µ—Å –∑–∞—è–≤–∫–∏:</b> <i>${address}</i>\\n`;\n\n  if (telephone) {\n    aggregatedText += `‚Ä¢ ‚òéÔ∏è<b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> <i>${telephone}</i>\\n\\n`;\n  } else {\n    aggregatedText += '\\n';\n  }\n});\n\nreturn [{json: {aggregatedText: aggregatedText}}];"},"id":"c381aa34-1111-4144-a326-e414faccf3d5","name":"—Ç–µ–∫—Å—Ç –º–∞—Å—Ç–µ—Ä","type":"n8n-nodes-base.code","typeVersion":1,"position":[1000,500]},{"parameters":{"jsCode":"let message_id = $node[\"—Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É\"].json[\"result\"][\"message_id\"].toString();\nreturn { message_id }"},"id":"a443be71-7712-4bb7-a8f8-5bc78165f84f","name":"Code","type":"n8n-nodes-base.code","typeVersion":1,"position":[1300,300]},{"parameters":{"jsCode":"let message_id = $node[\"—Å–æ–æ–±—â–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä—É\"].json[\"result\"][\"message_id\"].toString();\nreturn { message_id }"},"id":"b085914e-d616-4dac-80f3-7109d01c19a2","name":"Code1","type":"n8n-nodes-base.code","typeVersion":1,"position":[1300,500]},{"parameters":{"method":"POST","url":"https://app.leadteh.ru/api/v1/setContactVariable","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Requested-With","value":"XMLHttpRequest"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"api_token","value":"z3NKDDweLVTcwVNafiHKJUjwcSfTs17D2iGEzgmcIee9oclBLL5xRvqgGIVJ"},{"name":"contact_id","value":"={{ $node[\"Google Sheets\"].json[\"ID LT\"] }}"},{"name":"name","value":"notification"},{"name":"value","value":"‚ùå –£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"},{"name":"deletable","value":"0"}]},"options":{"response":{"response":{"fullResponse":true,"neverError":true,"responseFormat":"text"}}}},"id":"9dcc223b-947d-4474-9a98-43b8eec77ace","name":"HTTP Request","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1460,300],"credentials":{"httpBasicAuth":{"id":"35","name":"Unnamed credential"}}},{"parameters":{"method":"POST","url":"https://app.leadteh.ru/api/v1/setContactVariable","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Requested-With","value":"XMLHttpRequest"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"api_token","value":"z3NKDDweLVTcwVNafiHKJUjwcSfTs17D2iGEzgmcIee9oclBLL5xRvqgGIVJ"},{"name":"contact_id","value":"={{ $node[\"Google Sheets\"].json[\"ID LT\"] }}"},{"name":"name","value":"notification_id"},{"name":"value","value":"={{ $node[\"Code\"].json[\"message_id\"] }}"},{"name":"deletable","value":"0"}]},"options":{"response":{"response":{"fullResponse":true,"neverError":true,"responseFormat":"text"}}}},"id":"d7470c66-3f69-43a9-8682-353b2ba40a78","name":"HTTP Request1","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1620,300],"credentials":{"httpBasicAuth":{"id":"35","name":"Unnamed credential"}}},{"parameters":{"method":"POST","url":"https://app.leadteh.ru/api/v1/setContactVariable","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Requested-With","value":"XMLHttpRequest"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"api_token","value":"z3NKDDweLVTcwVNafiHKJUjwcSfTs17D2iGEzgmcIee9oclBLL5xRvqgGIVJ"},{"name":"contact_id","value":"={{ $node[\"Google Sheets\"].json[\"ID LT master\"] }}"},{"name":"name","value":"notification_master"},{"name":"value","value":"‚ùå –£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"},{"name":"deletable","value":"0"}]},"options":{"response":{"response":{"fullResponse":true,"neverError":true,"responseFormat":"text"}}}},"id":"897c5b57-87cd-4f23-9da8-3acee823f9ac","name":"HTTP Request2","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1460,500],"credentials":{"httpBasicAuth":{"id":"35","name":"Unnamed credential"}}},{"parameters":{"method":"POST","url":"https://app.leadteh.ru/api/v1/setContactVariable","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Requested-With","value":"XMLHttpRequest"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"api_token","value":"z3NKDDweLVTcwVNafiHKJUjwcSfTs17D2iGEzgmcIee9oclBLL5xRvqgGIVJ"},{"name":"contact_id","value":"={{ $node[\"Google Sheets\"].json[\"ID LT master\"] }}"},{"name":"name","value":"notification_master_id"},{"name":"value","value":"={{ $node[\"Code1\"].json[\"message_id\"] }}"},{"name":"deletable","value":"0"}]},"options":{"response":{"response":{"fullResponse":true,"neverError":true,"responseFormat":"text"}}}},"id":"14c727ac-0ea3-4f70-9d05-f49a0e886a32","name":"HTTP Request3","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1620,500],"credentials":{"httpBasicAuth":{"id":"35","name":"Unnamed credential"}}}],"connections":{"Schedule Trigger":{"main":[[{"node":"–ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞—Ç—ã","type":"main","index":0}]]},"–ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞—Ç—ã":{"main":[[{"node":"Google Sheets","type":"main","index":0}]]},"Google Sheets":{"main":[[{"node":"IF1","type":"main","index":0}]]},"IF1":{"main":[[{"node":"—Ç–µ–∫—Å—Ç –∫–ª–∏–µ–Ω—Ç","type":"main","index":0},{"node":"—Ç–µ–∫—Å—Ç –º–∞—Å—Ç–µ—Ä","type":"main","index":0}]]},"—Ç–µ–∫—Å—Ç –∫–ª–∏–µ–Ω—Ç":{"main":[[{"node":"—Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É","type":"main","index":0}]]},"—Ç–µ–∫—Å—Ç –º–∞—Å—Ç–µ—Ä":{"main":[[{"node":"—Å–æ–æ–±—â–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä—É","type":"main","index":0}]]},"—Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É":{"main":[[{"node":"Code","type":"main","index":0}]]},"—Å–æ–æ–±—â–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä—É":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"HTTP Request1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"HTTP Request2","type":"main","index":0}]]},"HTTP Request2":{"main":[[{"node":"HTTP Request3","type":"main","index":0}]]}},"settings":{},"staticData":{"node:Schedule Trigger":{"recurrencyRules":[]}},"meta":null,"pinData":{},"versionId":"baafdba3-34d0-4081-ae49-18417c2c91b1","triggerCount":1,"tags":[]}