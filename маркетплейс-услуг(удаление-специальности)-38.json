{"createdAt":"2023-04-20T02:31:04.707Z","updatedAt":"2023-05-11T04:43:43.000Z","id":"38","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥(—É–¥–∞–ª–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏)","active":true,"nodes":[{"parameters":{"path":"ccd38131-9e8d-4d7f-8a3c-40c9a031adea","options":{}},"id":"5b461beb-a78b-4a53-b03b-ba5c9976d4d6","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-60,440],"webhookId":"ccd38131-9e8d-4d7f-8a3c-40c9a031adea"},{"parameters":{"keepOnlySet":true,"values":{"string":[{"name":"Tags","value":"={{ $node[\"Webhook\"].json[\"query\"][\"tags\"] }}"}]},"options":{}},"id":"c6a60a20-d745-475a-bdff-2dce23aeafe0","name":"Set","type":"n8n-nodes-base.set","typeVersion":2,"position":[240,440]},{"parameters":{"method":"POST","url":"https://api.telegram.org/bot6255776658:AAE7tUXJpMBh9ZZN7BhV03bPvyfD5g3peQU/sendMessage","sendQuery":true,"queryParameters":{"parameters":[{"name":"chat_id","value":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}"},{"name":"text","value":"=<u>–°–ü–ò–°–û–ö –í–ê–®–ò –°–ü–ï–¶–ò–ê–õ–¨–ù–û–°–¢–ï–ô</u>\n\n{{ $node[\"—Ç–µ–∫—Å—Ç\"].json[\"list\"] }}\n\nüßπ <b>–ß–¢–û–ë–´ –£–î–ê–õ–ò–¢–¨ –°–ü–ï–¶–ò–ê–õ–¨–ù–û–°–¢–¨ –ù–ê–ñ–ú–ò–¢–ï –ö–ù–û–ü–ö–£ –ù–ò–ñ–ï</b>üëá"},{"name":"reply_markup","value":"={{ $node[\"–∫–Ω–æ–ø–∫–∏1\"].json[\"reply_markup\"] }}"},{"name":"parse_mode","value":"HTML"}]},"options":{}},"id":"9576a561-e8e3-4087-8efa-2edd32e72590","name":"HTTP Request","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[900,420]},{"parameters":{"jsCode":"const tagsArray = $node[\"Set\"].json[\"Tags\"];\ntagsArray.forEach((tag, index) => {\n  if (/[A-Z]/.test(tag)) {\n    tagsArray[index] = tag.replace(/([A-Z])/g, \" $1\");\n  }\n});\n\nlet header = `üë§ <b>–í–∞—à —Å—Ç–∞—Ç—É—Å –Ω–∞ —Å–µ—Ä–≤–∏—Å–µ \"${tagsArray[0]}\"</b>.`;\n\nlet emojiArray = [\"1Ô∏è‚É£\", \"2Ô∏è‚É£\", \"3Ô∏è‚É£\", \"4Ô∏è‚É£\", \"5Ô∏è‚É£\", \"6Ô∏è‚É£\", \"7Ô∏è‚É£\", \"8Ô∏è‚É£\", \"9Ô∏è‚É£\", \"üîü\"];\n\nlet aggregatedText = `${header}\\n\\n`;\n\nfor (let i = 1; i < tagsArray.length; i++){\n    let emojiIndex = i-1;\n    if (i > 10) {\n        emojiIndex = Math.floor((i-1)/10) - 1;\n        aggregatedText += `\\n${emojiArray[emojiIndex]}`;\n    }\n    else {\n        aggregatedText += '\\n';\n    }\n    aggregatedText += `${emojiArray[(i-1) % 10]} -  <i>${tagsArray[i]}</i>`;\n}\n\nreturn [\n    {\n        \"list\": aggregatedText\n    }\n]"},"id":"9cab7748-9640-4f73-bfb2-92bb3ae68f26","name":"—Ç–µ–∫—Å—Ç","type":"n8n-nodes-base.code","typeVersion":1,"position":[400,340]},{"parameters":{"operation":"deleteMessage","chatId":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}","messageId":"={{ $node[\"Code\"].json[\"msgid\"] }}"},"id":"a1bfa75e-2816-4aa2-96be-df171bf7d05a","name":"Telegram","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[740,420],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"mode":"combine","combinationMode":"multiplex","options":{}},"id":"6c51a7cb-235d-48d3-b834-07add136f554","name":"Merge1","type":"n8n-nodes-base.merge","typeVersion":2,"position":[580,420]},{"parameters":{"jsCode":"const inputData = items[0].json;\n\n// –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π y, msgid –∏ FIO\nlet yValue;\nlet msgidValue;\nlet fioValue;\nlet masterOtvetNewOrderValue;\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ª–∏ –æ–±—ä–µ–∫—Ç inputData.query, –∏ –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º –µ–≥–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ\nif (inputData.query && inputData.query.variables) {\ninputData.query.variables.forEach((variable) => {\nif (variable.name === 'y') {\nyValue = variable.value;\n} else if (variable.name === 'msgid') {\nmsgidValue = variable.value;\n} else if (variable.name === 'FIO') {\nfioValue = variable.value;\n} else if (variable.name === 'master_otvet_neworder') {\nmasterOtvetNewOrderValue = variable.value;\n}\n});\n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç —Å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏ y, msgid, FIO –∏ master_otvet_neworder\nreturn [{ json: { y: yValue, msgid: msgidValue, FIO: fioValue, master_otvet_neworder: masterOtvetNewOrderValue } }];"},"id":"cab86e89-7253-4cae-9c22-47529869c9de","name":"Code","type":"n8n-nodes-base.code","typeVersion":1,"position":[80,440]},{"parameters":{"jsCode":"let tags = items[0].json.Tags;\nlet keyboard = [];\n\nlet buttons = [];\n\nfor (let i = 1; i < tags.length; i++) {\n  let button = {\n    text: \"‚úñ\"+i.toString(),\n    callback_data: tags[i],\n  };\n  \n  buttons.push(button);\n\n  if (i % 4 === 0) { // –¥–æ–±–∞–≤–ª—è–µ–º —á–µ—Ç—ã—Ä–µ –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥\n    keyboard.push(buttons);\n    buttons = [];\n  }\n}\n\n// –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–Ω–æ–ø–∫–∏\nif (buttons.length > 0) {\n  keyboard.push(buttons);\n}\n\n// –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É \"–¥—Ä—É–≥–æ–π\"\nkeyboard.push([{text: \"üü° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è–º–∏\", callback_data: \"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è–º–∏\"}]);\n\nlet replyMarkup = JSON.stringify({\n  inline_keyboard: keyboard,\n});\n\nlet result = [];\n\n// –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤\nfor (let i = 0; i < items.length; i++) {\n  let item = items[i];\n  let output = {};\n  output.title = item.title;\n  output.link = item.link;\n  output.reply_markup = replyMarkup;\n  result.push(output);\n}\n\nreturn result;"},"id":"2ba894d1-91f7-4711-a869-4a5c0b4feda3","name":"–∫–Ω–æ–ø–∫–∏1","type":"n8n-nodes-base.code","typeVersion":1,"position":[400,520]}],"connections":{"Webhook":{"main":[[{"node":"Code","type":"main","index":0}]]},"Set":{"main":[[{"node":"—Ç–µ–∫—Å—Ç","type":"main","index":0},{"node":"–∫–Ω–æ–ø–∫–∏1","type":"main","index":0}]]},"—Ç–µ–∫—Å—Ç":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Telegram":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Telegram","type":"main","index":0}]]},"Code":{"main":[[{"node":"Set","type":"main","index":0}]]},"–∫–Ω–æ–ø–∫–∏1":{"main":[[{"node":"Merge1","type":"main","index":1}]]}},"settings":{},"staticData":null,"meta":null,"pinData":{},"versionId":"3544fd10-6bb3-473b-92eb-e221c1142668","triggerCount":1,"tags":[]}