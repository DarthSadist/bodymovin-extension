{"createdAt":"2023-04-28T23:09:21.272Z","updatedAt":"2023-05-05T23:55:12.000Z","id":"46","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ—Å —É—Å–ª—É–≥(—Ä–∞—Å—Å—ã–ª–∫–∞ –∫–ª–∏–µ–Ω—Ç—É –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ —Ü–µ–Ω—ã)","active":true,"nodes":[{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":2}]}},"id":"1f25a320-3d15-48ae-b087-b5ff5c62c97d","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1,"position":[140,260]},{"parameters":{"documentId":{"__rl":true,"value":"1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE","mode":"list","cachedResultName":"–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤(–º–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥)","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤(–º–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥)","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"–í–æ—Ä–æ–Ω–∫–∞","lookupValue":"5. 1—ã–π –≤–∏–∑–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω"}]},"options":{"returnAllMatches":"returnFirstMatch"}},"id":"bc656abe-04c7-4a04-989e-7618d9af78e2","name":"Google Sheets","type":"n8n-nodes-base.googleSheets","typeVersion":3,"position":[280,260],"credentials":{"googleSheetsOAuth2Api":{"id":"27","name":"Google Sheets account"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE","mode":"list","cachedResultName":"–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤(–º–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥)","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤(–º–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥)","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE/edit#gid=0"},"columnToMatchOn":"–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è","valueToMatchOn":"={{ $node[\"Google Sheets\"].json[\"–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è\"] }}","fieldsUi":{"values":[{"column":"–í–æ—Ä–æ–Ω–∫–∞","fieldValue":"6. —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É"}]},"options":{}},"id":"e38db598-18bb-4c49-b697-767c8028d0cc","name":"Google Sheets1","type":"n8n-nodes-base.googleSheets","typeVersion":3,"position":[420,260],"credentials":{"googleSheetsOAuth2Api":{"id":"27","name":"Google Sheets account"}}},{"parameters":{"documentId":{"__rl":true,"value":"1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE","mode":"list","cachedResultName":"–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤(–º–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥)","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤(–º–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥)","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"–í–æ—Ä–æ–Ω–∫–∞","lookupValue":"6. —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É"}]},"options":{"returnAllMatches":"returnAllMatches"}},"id":"3214056a-22d1-4eaa-b841-0cc7da959c0f","name":"Google Sheets2","type":"n8n-nodes-base.googleSheets","typeVersion":3,"position":[560,260],"credentials":{"googleSheetsOAuth2Api":{"id":"27","name":"Google Sheets account"}}},{"parameters":{"jsCode":"function getStatus(funnel) {\n  switch (funnel.split('.')[0]) {\n    case '4': return 'üìù –ú–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω';\n    case '5': return 'üö∂ 1—ã–π –≤–∏–∑–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω';\n    case '6': return 'üí≥ –¶–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É';\n    case '7': return '‚úÖ –ö–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª';\n    case '10': return 'ü™õ –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É';\n    default: return funnel;\n  }\n}\n\nlet aggregatedText = '';\nitems.forEach(item => {\n  const rowNumber = item.json.row_number;\n  const specialist = item.json['–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'];\n  const description = item.json['–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç'];\n  const executionDate = item.json['–î–∞—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n  const executionTime = item.json['–í—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n  let funnel = item.json['–í–æ—Ä–æ–Ω–∫–∞'];\n  const masterAppointed = item.json['–ú–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω'];\n  const cost = item.json['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç'] || '-';\n  const additionalMaterials = item.json['–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã'] || '-';\n  const comment = item.json['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] || '-';\n  const photo = item.json['–§–æ—Ç–æ'] || '-';\n\n  if (funnel.startsWith('4.')) {\n    funnel = 'üìù –ú–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω';\n  } else if (funnel.startsWith('5.')) {\n    funnel = 'üö∂ 1—ã–π –≤–∏–∑–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω';\n  } else if (funnel.startsWith('6.')) {\n    funnel = 'üí≥ –¶–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É';\n  } else if (funnel.startsWith('7.')) {\n    funnel = '‚úÖ –ö–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª';\n  } else if (funnel.startsWith('10.')) {\n    funnel = 'ü™õ –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É';\n  }\n  \n  aggregatedText += `‚û§ <b>–ó–∞—è–≤–∫–∞ ‚Ññ${rowNumber}</b>\\n\\n`;\n  aggregatedText += `‚Ä¢ üë§ <b>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</b> <i>${specialist}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÉ <b>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç:</b> <i>${description}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÖ <b>–î–∞—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è:</b> <i>${executionDate}</i>\\n`;\n  aggregatedText += `‚Ä¢ üï∞ <b>–í—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è:</b> <i>${executionTime}</i>\\n`;\n  aggregatedText += `‚Ä¢ üõ† <b>–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏:</b> <i>${getStatus(funnel)}</i>\\n`;\n  aggregatedText += `‚Ä¢ üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç:</b> <i>${cost}</i> ‚ÇΩ\\n`;\n  aggregatedText += `‚Ä¢ üóÉ <b>–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã:</b> <i>${additionalMaterials}</i>\\n`;\n  aggregatedText += `‚Ä¢ üí¨ <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b> <i>${comment}</i>\\n`;\n  aggregatedText += `‚Ä¢ üì∑ <b>–§–æ—Ç–æ:</b> <i>${photo}</i>\\n`;\n  \n  if (masterAppointed) {\n    aggregatedText += `‚Ä¢ üß∞ <b>–ú–∞—Å—Ç–µ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</b><i> üëã ${masterAppointed}</i>\\n`;\n  }\n\n  aggregatedText += '\\n';\n});\n\nreturn [{ json: { aggregatedText } }];"},"id":"f48d26cd-ba31-442c-8162-392f71da042b","name":"Code","type":"n8n-nodes-base.code","typeVersion":1,"position":[700,260]},{"parameters":{"chatId":"={{ $node[\"Google Sheets2\"].json[\"Telegram ID\"] }}","text":"=üì¢ –£–≤–µ–¥–æ–º–ª—è–µ–º –æ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏! \n\n{{ $json[\"aggregatedText\"] }}\n\n–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ –≤ —Ä–∞–∑–¥–µ–ª–µ —Ç–µ–∫—É—â–∏–µ –∑–∞—è–≤–∫–∏ üëÄüíº\n\nüì¢<b>–í–ê–ñ–ù–û</b>: <i>—á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É \"–£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ\" ! –ü–µ—Ä–µ–π—Ç–∏ –≤ –õ–∏—á–Ω—ã–π –∫–∞–±–µ–Ω–µ—Ç –º–æ–∂–Ω–æ –ø–æ –∫–Ω–æ–ø–∫–µ \"–ú–µ–Ω—é\", —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–π –≤ –Ω–∏–∂–Ω–µ–º –ª–µ–≤–æ–º —É–≥–ª—É.</i>","replyMarkup":"inlineKeyboard","additionalFields":{"parse_mode":"HTML"}},"id":"7b7330ac-4e57-4d47-b749-93cac9b9b92d","name":"Telegram","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[840,260],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"method":"POST","url":"https://app.leadteh.ru/api/v1/setContactVariable","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Requested-With","value":"XMLHttpRequest"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"api_token","value":"z3NKDDweLVTcwVNafiHKJUjwcSfTs17D2iGEzgmcIee9oclBLL5xRvqgGIVJ"},{"name":"contact_id","value":"={{ $node[\"Google Sheets2\"].json[\"ID LT\"] }}"},{"name":"name","value":"notification"},{"name":"value","value":"‚ùå –£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"},{"name":"deletable","value":"0"}]},"options":{"response":{"response":{"fullResponse":true,"neverError":true,"responseFormat":"text"}}}},"id":"468fd7b2-9a30-4db9-91c5-0ea225a4d0f4","name":"HTTP Request","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1120,260],"credentials":{"httpBasicAuth":{"id":"35","name":"Unnamed credential"}}},{"parameters":{"method":"POST","url":"https://app.leadteh.ru/api/v1/setContactVariable","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Requested-With","value":"XMLHttpRequest"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"api_token","value":"z3NKDDweLVTcwVNafiHKJUjwcSfTs17D2iGEzgmcIee9oclBLL5xRvqgGIVJ"},{"name":"contact_id","value":"={{ $node[\"Google Sheets2\"].json[\"ID LT\"] }}"},{"name":"name","value":"notification_id"},{"name":"value","value":"={{ $node[\"Code1\"].json[\"message_id\"] }}"},{"name":"deletable","value":"0"}]},"options":{"response":{"response":{"fullResponse":true,"neverError":true,"responseFormat":"text"}}}},"id":"3b240605-3940-43a1-bcd1-8cbe49814660","name":"HTTP Request1","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1260,260],"credentials":{"httpBasicAuth":{"id":"35","name":"Unnamed credential"}}},{"parameters":{"jsCode":"let message_id = $node[\"Telegram\"].json[\"result\"][\"message_id\"].toString();\nreturn { message_id }"},"id":"bebf24d6-7b53-4065-b1d4-317767085f32","name":"Code1","type":"n8n-nodes-base.code","typeVersion":1,"position":[980,260]}],"connections":{"Schedule Trigger":{"main":[[{"node":"Google Sheets","type":"main","index":0}]]},"Google Sheets":{"main":[[{"node":"Google Sheets1","type":"main","index":0}]]},"Google Sheets1":{"main":[[{"node":"Google Sheets2","type":"main","index":0}]]},"Google Sheets2":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Telegram","type":"main","index":0}]]},"Telegram":{"main":[[{"node":"Code1","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"HTTP Request1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]}},"settings":{},"staticData":{"node:Schedule Trigger":{"recurrencyRules":[]}},"meta":null,"pinData":{},"versionId":"4f946b97-99b5-406d-b30e-ae21b4ad2a30","triggerCount":1,"tags":[]}