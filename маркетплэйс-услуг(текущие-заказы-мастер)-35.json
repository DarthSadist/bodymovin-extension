{"createdAt":"2023-04-17T10:20:03.845Z","updatedAt":"2023-05-17T13:47:24.000Z","id":"35","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥(—Ç–µ–∫—É—â–∏–µ –∑–∞–∫–∞–∑—ã –º–∞—Å—Ç–µ—Ä)","active":true,"nodes":[{"parameters":{"path":"4d15b241-2a30-4c7d-b75c-dd23014e021f","options":{}},"id":"b6b105ce-4c08-4559-9ee2-ce54feddbab9","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-20,360],"webhookId":"4d15b241-2a30-4c7d-b75c-dd23014e021f"},{"parameters":{"jsCode":"// –ü–æ–ª—É—á–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\nconst inputData = items[0].json;\n\n// –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π z, msgid –∏ FIO\nlet zValue;\nlet msgidValue;\nlet fioValue;\nlet masterOtvetNewOrderValue;\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ª–∏ –æ–±—ä–µ–∫—Ç inputData.query, –∏ –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º –µ–≥–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ\nif (inputData.query && inputData.query.variables) {\ninputData.query.variables.forEach((variable) => {\nif (variable.name === 'z') {\nzValue = variable.value;\n} else if (variable.name === 'msgid') {\nmsgidValue = variable.value;\n} else if (variable.name === 'FIO') {\nfioValue = variable.value;\n} else if (variable.name === 'master_otvet_neworder') {\nmasterOtvetNewOrderValue = variable.value;\n}\n});\n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç —Å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏ y, msgid, FIO –∏ master_otvet_neworder\nreturn [{ json: { z: zValue, msgid: msgidValue, FIO: fioValue, master_otvet_neworder: masterOtvetNewOrderValue } }];"},"id":"9a9652f4-f071-412d-8472-2230830d6398","name":"Code","type":"n8n-nodes-base.code","typeVersion":1,"position":[120,360]},{"parameters":{"dataType":"string","value1":"={{ $json[\"z\"] }}","rules":{"rules":[{"value2":"1"},{"value2":"2","output":1}]}},"id":"2ec843d1-c779-43f1-abd0-dfd2da8eac47","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":1,"position":[280,360]},{"parameters":{"documentId":{"__rl":true,"value":"1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE","mode":"list","cachedResultName":"–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤(–º–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥)","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤(–º–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥)","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"–ú–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω","lookupValue":"={{ $json[\"–§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ –º–∞—Å—Ç–µ—Ä–∞\"] }}"}]},"options":{"returnAllMatches":"returnAllMatches"}},"id":"4c63bf0c-1065-4294-bc98-3a524cce7fb3","name":"Google Sheets","type":"n8n-nodes-base.googleSheets","typeVersion":3,"position":[100,160],"alwaysOutputData":true,"credentials":{"googleSheetsOAuth2Api":{"id":"27","name":"Google Sheets account"}}},{"parameters":{"documentId":{"__rl":true,"value":"1hX8TE9h7i3eVeETH7SmBcz_vhOK2EBSWOiuYumPC8l0","mode":"list","cachedResultName":"–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º–∞—Å—Ç–µ—Ä–∞","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1hX8TE9h7i3eVeETH7SmBcz_vhOK2EBSWOiuYumPC8l0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º–∞—Å—Ç–µ—Ä–∞","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1hX8TE9h7i3eVeETH7SmBcz_vhOK2EBSWOiuYumPC8l0/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"Telegram ID","lookupValue":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}"}]},"options":{"returnAllMatches":"returnAllMatches"}},"id":"fe7f8c48-d94d-44c6-98e3-64749cd5e47d","name":"Google Sheets1","type":"n8n-nodes-base.googleSheets","typeVersion":3,"position":[-60,160],"credentials":{"googleSheetsOAuth2Api":{"id":"27","name":"Google Sheets account"}}},{"parameters":{"jsCode":"let aggregatedText = '';\nlet numRequests = 0;\n\nitems.forEach(item => {\n  const rowNumber = item.json.row_number;\n  const specialist = item.json['–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'];\n  let description = item.json['–ó–∞–¥–∞—á–∞'];\n  let date = item.json['–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞'];\n  let time = item.json['–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞'];\n  let funnel = item.json['–í–æ—Ä–æ–Ω–∫–∞'];\n  const masterAppointed = item.json['–ú–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω'];\n  let cost = '';\n  let additionalMaterials = '';\n  let comment = '';\n  let photo = '';\n  let showAdditionalInfo = false;\n\n  if (funnel === \"6. —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É\") {\n      date = item.json['–î–∞—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n      time = item.json['–í—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n      description = item.json['–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç'];\n      cost = item.json['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç'] || \"–ù–µ—Ç\";\n      additionalMaterials = item.json['–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã'] || \"–ù–µ—Ç\";\n      comment = item.json['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] || \"–ù–µ—Ç\";\n      photo = item.json['–§–æ—Ç–æ'] || \"–ù–µ—Ç\";\n  } else if (funnel === \"7. –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª\" || funnel === \"10. –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É\") {\n      cost = item.json['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç'] || \"–ù–µ—Ç\";\n      additionalMaterials = item.json['–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã'] || \"–ù–µ—Ç\";\n      comment = item.json['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] || \"–ù–µ—Ç\";\n      photo = item.json['–§–æ—Ç–æ'] || \"–ù–µ—Ç\";\n      showAdditionalInfo = true;\n  }\n\n  if (funnel.startsWith('4.')) {\n    funnel = 'üìù –º–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω';\n  } else if (funnel.startsWith('5.')) {\n    funnel = 'üö∂ 1—ã–π –≤–∏–∑–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω';\n  } else if (funnel.startsWith('6.')) {\n    funnel = 'üí≥ —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É';\n  } else if (funnel.startsWith('7.')) {\n    funnel = '‚úÖ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª';\n  } else if (funnel.startsWith('10.')) {\n    funnel = 'üîß –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É';\n  }\n\n  aggregatedText += `‚û§ <b>–ó–∞—è–≤–∫–∞ ‚Ññ${rowNumber}</b>\\n\\n`;\n  aggregatedText += `‚Ä¢ üë§<b>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</b> <i>${specialist || \"–ù–µ—Ç\"}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÉ<b>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç:</b> <i>${description || \"–ù–µ—Ç\"}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÖ<b>–î–∞—Ç–∞:</b> <i>${date || \"–ù–µ—Ç\"}</i>\\n`;\n  aggregatedText += `‚Ä¢ üï∞<b>–í—Ä–µ–º—è:</b> <i>${time || \"–ù–µ—Ç\"}</i>\\n`;\n  aggregatedText += `‚Ä¢ üõ† <b>–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏:</b> <i>${funnel}</i>\\n`;\n\n  if (cost) {\n    aggregatedText += `‚Ä¢ üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç:</b> <i>${cost}</i>\\n`;\n  }\n  \n  if (additionalMaterials) {\n    aggregatedText += `‚Ä¢ üõí <b>–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã:</b> <i>${additionalMaterials}</i>\\n`;\n  }\n  \n  if (comment) {\n    aggregatedText += `‚Ä¢ üí¨ <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b> <i>${comment}</i>\\n`;\n  }\n  \n  if (photo) {\n    aggregatedText += `‚Ä¢ üì∑ <b>–§–æ—Ç–æ:</b> <i>${photo}</i>\\n`;\n  }\n\n\n  aggregatedText += '\\n';\n  numRequests++;\n});\n\naggregatedText += `Ôºú <b>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫ –≤ —Ä–∞–±–æ—Ç–µ: ${numRequests} –∑–∞—è–≤–∫–∏</b> Ôºû`;\n\nreturn [{json: {aggregatedText: aggregatedText}}];"},"id":"288e94a6-7aeb-4729-932d-45e8b56b25e2","name":"—Ç–µ–∫—Å—Ç","type":"n8n-nodes-base.code","typeVersion":1,"position":[680,-120]},{"parameters":{"jsCode":"const buttons = items.map(item => {\n  const rowNumber = item.json['row_number'];\n  const createdDate = item.json['–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è']; // –ø–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è\n  return {\n    text: `üü¢ –ó–∞—è–≤–∫–∞ ‚Ññ${rowNumber}`,\n    callback_data: createdDate // –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ callback_data\n  };\n});\n\nconst keyboardRows = buttons.reduce((resultArray, item, index) => { \n  const chunkIndex = Math.floor(index / 3);\n\n  if(!resultArray[chunkIndex]) {\n    resultArray[chunkIndex] = [] // –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π —Ä—è–¥\n  }\n\n  resultArray[chunkIndex].push(item);\n\n  return resultArray;\n}, []);\n\nconst keyboard = {\n  inline_keyboard: [...keyboardRows, [\n    {\n      text: \"üîµ –ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞\",\n      callback_data: \"–ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞\"\n    }\n  ]]\n};\n\nreturn { json: { reply_markup: JSON.stringify(keyboard) } };"},"id":"0ddde2b2-cdaf-4ebb-893e-cfafc0f7c5c6","name":"–∫–Ω–æ–ø–∫–∏","type":"n8n-nodes-base.code","typeVersion":1,"position":[680,20]},{"parameters":{"mode":"combine","combinationMode":"multiplex","options":{}},"id":"e8dfa816-0e20-435b-b560-c1ab88da96cb","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2,"position":[840,-60]},{"parameters":{"conditions":{"boolean":[{"value1":"={{ $json[\"isEmpty\"] }}","value2":true}]}},"id":"587aa724-3d7b-4c5d-b0a1-a6b6b9a8c1cd","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[440,160]},{"parameters":{"operation":"deleteMessage","chatId":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}","messageId":"={{ $node[\"Code\"].json[\"msgid\"] }}"},"id":"b3565723-a4db-48a3-b89a-123d1bb68d41","name":"Telegram","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1000,-60],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"method":"POST","url":"https://api.telegram.org/bot6255776658:AAE7tUXJpMBh9ZZN7BhV03bPvyfD5g3peQU/sendMessage","sendQuery":true,"queryParameters":{"parameters":[{"name":"chat_id","value":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}"},{"name":"text","value":"=         <b>–í–ê–®–ò –¢–ï–ö–£–©–ò–ï –ó–ê–Ø–í–ö–ò</b>\n\n{{ $node[\"—Ç–µ–∫—Å—Ç\"].json[\"aggregatedText\"] }}\n\n\n<b>‚öô –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∞–º–∏ –∑–∞—è–≤–∫–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã –ø–æ –Ω–µ–π</b>üëá"},{"name":"reply_markup","value":"={{ $node[\"–∫–Ω–æ–ø–∫–∏\"].json[\"reply_markup\"] }}"},{"name":"parse_mode","value":"HTML"}]},"options":{}},"id":"33105164-9fd0-449a-b60c-3aadced78890","name":"HTTP Request","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[1160,-60]},{"parameters":{"jsCode":"const inputData = items;\n\nconst filteredData = inputData.filter((item) => {\n  const funnelValue = item.json[\"–í–æ—Ä–æ–Ω–∫–∞\"];\n  return (\n    funnelValue !== \"8. –∫–ª–∏–µ–Ω—Ç –æ—Ç–∫–∞–∑–∞–ª—Å—è\" &&\n    funnelValue !== \"9. –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏–Ω—è–ª —Ä–∞–±–æ—Ç—É\"\n  );\n});\n\nif (Object.keys($node['Google Sheets'].json).length === 0 || filteredData.length === 0) {\n  return [{json: {isEmpty: true}}];\n} else {\n  return filteredData;\n}"},"id":"1310cbbc-b62f-4353-b90c-b14ebdd24e8e","name":"—Ñ–∏–ª—å—Ç—Ä –∑–∞—è–≤–æ–∫","type":"n8n-nodes-base.code","typeVersion":1,"position":[280,160],"alwaysOutputData":false},{"parameters":{"documentId":{"__rl":true,"value":"1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE","mode":"list","cachedResultName":"–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤(–º–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥)","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤(–º–∞—Ä–∫–µ—Ç–ø–ª—ç–π—Å —É—Å–ª—É–≥)","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1_mVTlW_BvNIQ30QbtAC59sPq3-ynnggfG01WI4A0WjE/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è","lookupValue":"={{ $json[\"master_otvet_neworder\"] }}"}]},"options":{}},"id":"53a6f402-66e0-4996-8604-0b4530f1c20b","name":"Google Sheets2","type":"n8n-nodes-base.googleSheets","typeVersion":3,"position":[660,360],"credentials":{"googleSheetsOAuth2Api":{"id":"27","name":"Google Sheets account"}}},{"parameters":{"chatId":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}","text":"=üì¢ –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –º—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –≤ —Ä–∞–±–æ—Ç–µ.\n \n–ù–æ –Ω–µ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ—Å—å! –í —Ä–∞–∑–¥–µ–ª–µ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫ –í—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–π–¥–µ—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∑–∞–¥–∞—á–∏. ü§©  üîç –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫ –∏ –∏—â–∏—Ç–µ –∑–∞—è–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥—Ö–æ–¥—è—Ç –∏–º–µ–Ω–Ω–æ –í–∞–º. üíº  üëÄ\n \n–ï—Å–ª–∏ –∂–µ –Ω—É–∂–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç, –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π—Ç–µ. –ú—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–≤–µ–¥–æ–º–∏–º –í–∞—Å –æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤. üì©  –ù–µ —Ç–µ—Ä—è–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∞–º–∏! üí™","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"üü¢ –ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞","additionalFields":{"callback_data":"–ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞"}}]}}]},"additionalFields":{}},"id":"525b1318-179a-4a9c-8eeb-db5e68e3f079","name":"Telegram1","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[420,-60],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"operation":"deleteMessage","chatId":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}","messageId":"={{ $node[\"Code\"].json[\"msgid\"] }}"},"id":"ed924df6-2963-4ef9-b7ac-c204e30a1a6e","name":"Telegram2","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[280,-60],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"content":"–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–∞—è–≤–æ–∫ –≤ —Ä–∞–±–æ—Ç–µ","height":190.81410376970766,"width":351.1987222993792},"id":"d69e761c-b56b-4581-bf41-d6bdc9ae2c31","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[223.064105813994,-102.58333265190458]},{"parameters":{"content":"–§–ò–õ–¨–†–ê–¶–ò–Ø","height":172.05769277945075,"width":739.7243785261254},"id":"355c877a-0545-43dc-b7e5-faa5f9fe66cd","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-140,127.94230722054925]},{"parameters":{"content":"–°–û–û–ë–©–ï–ù–ò–ï –û –¢–ï–ö–£–©–ò–• –ó–ê–Ø–í–ö–ê–•","height":312.7307752063763,"width":738.3846348839645},"id":"d5fd9f39-980b-402a-b40a-d7b68f0d2370","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[640,-160]},{"parameters":{"content":"–°–¢–ê–†–¢–û–í–´–ô –ë–õ–û–ö","height":186.79487284322377,"width":525.3653957803336},"id":"b9a0d872-7bab-47aa-a766-1e7386a180d6","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-65.0705106713906,320]},{"parameters":{"jsCode":"let aggregatedText = '';\n\nitems.forEach(item => {\n  const rowNumber = item.json.row_number;\n  const specialist = item.json['–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'];\n  let description = item.json['–ó–∞–¥–∞—á–∞'];\n  let date = item.json['–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞'];\n  let time = item.json['–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞'];\n  let funnel = item.json['–í–æ—Ä–æ–Ω–∫–∞'];\n  const masterAppointed = item.json['–ú–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω'];\n  let cost = '';\n  let additionalMaterials = '';\n  let comment = '';\n  let photo = '';\n  let showAdditionalInfo = false;\n\n  if (funnel === \"6. —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É\") {\n      date = item.json['–î–∞—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n      time = item.json['–í—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n      description = item.json['–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç'];\n      cost = item.json['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç'] || \"–ù–µ—Ç\";\n      additionalMaterials = item.json['–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã'] || \"–ù–µ—Ç\";\n      comment = item.json['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] || \"–ù–µ—Ç\";\n      photo = item.json['–§–æ—Ç–æ'] || \"–ù–µ—Ç\";\n  } else if (funnel === \"7. –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª\" || funnel === \"10. –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É\") {\n      cost = item.json['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç'] || \"–ù–µ—Ç\";\n      additionalMaterials = item.json['–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã'] || \"–ù–µ—Ç\";\n      comment = item.json['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] || \"–ù–µ—Ç\";\n      photo = item.json['–§–æ—Ç–æ'] || \"–ù–µ—Ç\";\n      showAdditionalInfo = true;\n  }\n\n  if (funnel.startsWith('4.')) {\n    funnel = 'üìù –º–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω';\n  } else if (funnel.startsWith('5.')) {\n    funnel = 'üö∂ 1—ã–π –≤–∏–∑–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω';\n  } else if (funnel.startsWith('6.')) {\n    funnel = 'üí≥ —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É';\n  } else if (funnel.startsWith('7.')) {\n    funnel = '‚úÖ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª';\n  } else if (funnel.startsWith('10.')) {\n    funnel = 'üîß –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É';\n  }\n\n  aggregatedText += `‚û§ <b>–ó–∞—è–≤–∫–∞ ‚Ññ${rowNumber}</b>\\n\\n`;\n  aggregatedText += `‚Ä¢ üë§<b>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</b> <i>${specialist}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÉ<b>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç:</b> <i>${description}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÖ<b>–î–∞—Ç–∞:</b> <i>${date}</i>\\n`;\n  aggregatedText += `‚Ä¢ üï∞<b>–í—Ä–µ–º—è:</b> <i>${time}</i>\\n`;\n  aggregatedText += `‚Ä¢ üõ† <b>–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏:</b> <i>${funnel}</i>\\n`;\n\n  if (cost) {\n    aggregatedText += `‚Ä¢ üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç:</b> <i>${cost}</i>\\n`;\n  }\n  \n  if (additionalMaterials) {\n    aggregatedText += `‚Ä¢ üõí <b>–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã:</b> <i>${additionalMaterials}</i>\\n`;\n  }\n  \n  if (comment) {\n    aggregatedText += `‚Ä¢ üí¨ <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b> <i>${comment}</i>\\n`;\n  }\n  \n  if (photo) {\n    aggregatedText += `‚Ä¢ üì∑ <b>–§–æ—Ç–æ:</b> <i>${photo}</i>\\n`;\n  }\n\n\n  aggregatedText += '\\n';\n});\n\nreturn [{json: {aggregatedText: aggregatedText}}];"},"id":"e9b1eebc-019f-40c1-a53f-69cc6dd22884","name":"—Ç–µ–∫—Å—Ç1","type":"n8n-nodes-base.code","typeVersion":1,"position":[800,360]},{"parameters":{"chatId":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}","text":"={{ $node[\"—Ç–µ–∫—Å—Ç1\"].json[\"aggregatedText\"] }}\n\n<b>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Å –∑–∞—è–≤–∫–æ–π</b>\n\n‚òû üóÇ <i>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤–æ–ø—Ä–æ—Å–Ω–∏–∫ –≤–∏–∑–∏—Ç–∞</i><b> (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω–æ–π –æ–ø—Ü–∏–∏ –ø–æ–¥ –≤–æ–ø—Ä–æ—Å–æ–º)</b>\n\n‚òû ‚úÖ <i>–ù–∞–∂–º–∏—Ç–µ \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ\", –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</i>\n\n‚òû ‚ûï <i>–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–∞–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç—É, –Ω–∞–∂–º–∏—Ç–µ \"–¥–æ–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç—É\"</i>","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"üóÇ –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å–Ω–∏–∫","additionalFields":{"callback_data":"–ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å–Ω–∏–∫"}}]}},{"row":{"buttons":[{"text":"‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ","additionalFields":{"callback_data":"–í—ã–ø–æ–ª–Ω–µ–Ω–æ"}}]}},{"row":{"buttons":[{"text":"‚ûï –î–æ–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç—É","additionalFields":{"callback_data":"–î–æ–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç—É"}}]}},{"row":{"buttons":[{"text":"üü¢ –ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞","additionalFields":{"callback_data":"–ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞"}}]}}]},"additionalFields":{"parse_mode":"HTML"}},"id":"316e5dca-9c2f-4416-92ec-643812153766","name":"Telegram3","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1420,240],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"content":"–†–∞–±–æ—Ç–∞ —Å –æ—Ç–¥–µ–ª—å–Ω–æ–π –∑–∞—è–≤–∫–æ–π","height":216.62813345056708,"width":507.26695903445045},"id":"35d91c32-9901-4513-b469-43f2636e5d22","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[620,300]},{"parameters":{"operation":"deleteMessage","chatId":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}","messageId":"={{ $node[\"Code\"].json[\"msgid\"] }}"},"id":"0f263d97-d4f7-4082-8839-653346c73d09","name":"Telegram4","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1240,240],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"operation":"deleteMessage","chatId":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}","messageId":"={{ $node[\"Code\"].json[\"msgid\"] }}"},"id":"c674ff98-8094-479a-8cd9-ea65579c0a2f","name":"Telegram5","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1240,480],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"chatId":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}","text":"={{ $node[\"—Ç–µ–∫—Å—Ç1\"].json[\"aggregatedText\"] }}\n\n<b>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Å –∑–∞—è–≤–∫–æ–π</b>\n\n\n‚òû ‚úÖ <i>–ù–∞–∂–º–∏—Ç–µ \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ\", –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</i>\n\n‚òû ‚ûï <i>–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–∞–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç—É, –Ω–∞–∂–º–∏—Ç–µ \"–¥–æ–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç—É\"</i>","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ","additionalFields":{"callback_data":"–í—ã–ø–æ–ª–Ω–µ–Ω–æ"}}]}},{"row":{"buttons":[{"text":"‚ûï –î–æ–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç—É","additionalFields":{"callback_data":"–î–æ–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç—É"}}]}},{"row":{"buttons":[{"text":"üü¢ –ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞","additionalFields":{"callback_data":"–ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞"}}]}}]},"additionalFields":{"parse_mode":"HTML"}},"id":"1a6b0c78-ea46-4cf5-8ff7-4b863d65556d","name":"Telegram6","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1440,480],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"operation":"deleteMessage","chatId":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}","messageId":"={{ $node[\"Code\"].json[\"msgid\"] }}"},"id":"532bb170-9d92-453c-9f3f-1dd0f012e0fd","name":"Telegram7","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1240,720],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"chatId":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}","text":"={{ $node[\"—Ç–µ–∫—Å—Ç1\"].json[\"aggregatedText\"] }}\n\n<b>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Å –∑–∞—è–≤–∫–æ–π</b>\n\n‚òû ‚úÖ <i>–ù–∞–∂–º–∏—Ç–µ \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ\", –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</i>\n","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ","additionalFields":{"callback_data":"–í—ã–ø–æ–ª–Ω–µ–Ω–æ"}}]}},{"row":{"buttons":[{"text":"üü¢ –ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞","additionalFields":{"callback_data":"–ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞"}}]}}]},"additionalFields":{"parse_mode":"HTML"}},"id":"736998a5-f861-4fe4-8abc-05444de8c8a1","name":"Telegram8","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1440,720],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"dataType":"string","value1":"={{ $node[\"Google Sheets2\"].json[\"–í–æ—Ä–æ–Ω–∫–∞\"] }}","rules":{"rules":[{"value2":"4. –º–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω"},{"value2":"5. 1—ã–π –≤–∏–∑–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω","output":1},{"value2":"10. –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É","output":2},{"value2":"6. —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É","output":3},{"value2":"7. –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª","output":3}]}},"id":"71613789-49cb-45d7-bba5-ae705b52c67a","name":"Switch1","type":"n8n-nodes-base.switch","typeVersion":1,"position":[1020,360]},{"parameters":{"operation":"deleteMessage","chatId":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}","messageId":"={{ $node[\"Code\"].json[\"msgid\"] }}"},"id":"d437c944-f0ae-4955-acbd-7f2d3392781f","name":"Telegram9","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1240,940],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"chatId":"={{ $node[\"Webhook\"].json[\"query\"][\"telegram_id\"] }}","text":"={{ $node[\"—Ç–µ–∫—Å—Ç1\"].json[\"aggregatedText\"] }}\n\n<b>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Å –∑–∞—è–≤–∫–æ–π</b>\n\n‚òû ‚úÖ <i>–ù–∞–∂–º–∏—Ç–µ \"–í—ã–ø–æ–ª–Ω–µ–Ω–æ\", –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</i>\n\n‚òû ‚ûï <i>–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–∞–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç—É, –Ω–∞–∂–º–∏—Ç–µ \"–¥–æ–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç—É\"</i>","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ","additionalFields":{"callback_data":"–í—ã–ø–æ–ª–Ω–µ–Ω–æ"}}]}},{"row":{"buttons":[{"text":"‚ûï –î–æ–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç—É","additionalFields":{"callback_data":"–î–æ–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç—É"}}]}},{"row":{"buttons":[{"text":"üü¢ –ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞","additionalFields":{"callback_data":"–ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞"}}]}}]},"additionalFields":{"parse_mode":"HTML"}},"id":"3783be72-edec-4efc-89b0-6a1af73636a5","name":"Telegram10","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1440,940],"credentials":{"telegramApi":{"id":"33","name":"–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —É—Å–ª—É–≥–∏"}}},{"parameters":{"jsCode":"let aggregatedText = '';\n\nitems.forEach(item => {\n  const rowNumber = item.json.row_number;\n  const specialist = item.json['–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'];\n  const task = item.json['–ó–∞–¥–∞—á–∞'];\n  const date = item.json['–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞'];\n  const time = item.json['–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞'];\n  let funnel = item.json['–í–æ—Ä–æ–Ω–∫–∞'];\n  const address = item.json['–ê–¥—Ä–µ—Å'];\n  const telephone = item.json['–¢–µ–ª–µ—Ñ–æ–Ω'];\n\n  if (funnel.startsWith('4.')) {\n    funnel = 'üìù –º–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω';\n  } else if (funnel.startsWith('5.')) {\n    funnel = 'üö∂ 1—ã–π –≤–∏–∑–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω';\n  } else if (funnel.startsWith('6.')) {\n    funnel = 'üí≥ —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É';\n  } else if (funnel.startsWith('7.')) {\n    funnel = '‚úÖ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª';\n  } else if (funnel.startsWith('10.')) {\n    funnel = 'ü™õ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É';\n  }\n\n  aggregatedText += `‚û§ <b>–ó–∞—è–≤–∫–∞ ‚Ññ${rowNumber}</b>\\n\\n`;\n  aggregatedText += `‚Ä¢ üë§ <b>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</b> <i>${specialist}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÉ <b>–ó–∞–¥–∞—á–∞:</b> <i>${task}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÖ <b>–î–∞—Ç–∞:</b> <i>${date}</i>\\n`;\n  aggregatedText += `‚Ä¢ üï∞ <b>–í—Ä–µ–º—è:</b> <i>${time}</i>\\n`;\n  aggregatedText += `‚Ä¢ üõ† <b>–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏:</b> <i>${funnel}</i>\\n`;\n  aggregatedText += `‚Ä¢ üè† <b>–ê–¥—Ä–µ—Å –∑–∞—è–≤–∫–∏:</b> <i>${address}</i>\\n`;\n\n  if (telephone) {\n    aggregatedText += `‚Ä¢ ‚òéÔ∏è <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> <code>+${telephone}</code> <i>(–Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ)</i>\\n\\n`;\n  } else {\n    aggregatedText += '\\n';\n  }\n});\n\nreturn [{json: {aggregatedText}}];"},"id":"5dc5696d-2793-465c-9ae3-deeeebab0a7f","name":"—Ç–µ–∫—Å—Ç2","type":"n8n-nodes-base.code","typeVersion":1,"position":[1080,-260]},{"parameters":{"jsCode":"let aggregatedText = '';\n\nconst FUNNEL_STATUS_MAP = {\n  '4.': 'üìù –º–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω',\n  '5.': 'üö∂ 1—ã–π –≤–∏–∑–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω',\n  '6.': 'üí≥ —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É',\n  '7.': '‚úÖ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª',\n  '10.': 'üîß –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É'\n};\n\nfunction formatText(value) {\n  return value ? `<i>${value}</i>` : '–ù–µ—Ç';\n}\n\nitems.forEach(item => {\n  const rowNumber = item.json.row_number;\n  const specialist = item.json['–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'];\n  let description = item.json['–ó–∞–¥–∞—á–∞'];\n  let date = item.json['–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞'];\n  let time = item.json['–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞'];\n  let funnel = item.json['–í–æ—Ä–æ–Ω–∫–∞'];\n  const masterAppointed = item.json['–ú–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω'];\n  let cost = '';\n  let additionalMaterials = '';\n  let comment = '';\n  let photo = '';\n  let showAdditionalInfo = false;\n\n  if (funnel === '6. —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É' || funnel === '7. –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª' || funnel === '10. –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É') {\n      date = item.json['–î–∞—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n      time = item.json['–í—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n      description = item.json['–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç'];\n      cost = formatText(item.json['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç']);\n      additionalMaterials = formatText(item.json['–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã']);\n      comment = formatText(item.json['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π']);\n      photo = formatText(item.json['–§–æ—Ç–æ']);\n  }\n\n  funnel = FUNNEL_STATUS_MAP[funnel.slice(0, 2)] || funnel;\n\n  aggregatedText += `‚û§ <b>–ó–∞—è–≤–∫–∞ ‚Ññ${rowNumber}</b>\\n\\n`;\n  aggregatedText += `‚Ä¢ üë§<b>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</b> ${formatText(specialist)}\\n`;\n  aggregatedText += `‚Ä¢ üìÉ<b>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç:</b> ${formatText(description)}\\n`;\n  aggregatedText += `‚Ä¢ üìÖ<b>–î–∞—Ç–∞:</b> ${formatText(date)}\\n`;\n  aggregatedText += `‚Ä¢ üï∞<b>–í—Ä–µ–º—è:</b> ${formatText(time)}\\n`;\n  aggregatedText += `‚Ä¢ üõ† <b>–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏:</b> ${formatText(funnel)}\\n`;\n\n  if (cost) {\n    aggregatedText += `‚Ä¢ üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç:</b> ${cost} ‚ÇΩ\\n`;\n  }\n  \n  if (additionalMaterials) {\n    aggregatedText += `‚Ä¢ üõí <b>–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã:</b> ${additionalMaterials}\\n`;\n  }\n  \n  if (comment) {\n    aggregatedText += `‚Ä¢ üí¨ <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b> ${comment}\\n`;\n  }\n  \n  if (photo) {\n    aggregatedText += `‚Ä¢ üì∑ <b>–§–æ—Ç–æ:</b> ${photo}\\n`;\n  }\n\n  if (showAdditionalInfo && masterAppointed) {\n    aggregatedText += `‚Ä¢ üß∞ <b>–ú–∞—Å—Ç–µ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</b><i>üëã ${masterAppointed}</i>\\n`;\n  } else if (masterAppointed) {\n    aggregatedText += `‚Ä¢ üß∞ <b>–í–∞–º –Ω–∞–∑–Ω–∞—á–µ–Ω –º–∞—Å—Ç–µ—Ä: </b><i>üëã ${masterAppointed}</i>\\n`;\n  }\n\n  aggregatedText += '\\n';\n});\n\nreturn [{ json: { aggregatedText } }];"},"id":"cb6a24eb-54a7-44ba-8bd4-6cf627bb10d8","name":"—Ç–µ–∫—Å—Ç3","type":"n8n-nodes-base.code","typeVersion":1,"position":[1060,-400]},{"parameters":{"jsCode":"let aggregatedText = '';\n\nitems.forEach(item => {\n  const rowNumber = item.json.row_number;\n  const specialist = item.json['–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'];\n  let description = item.json['–ó–∞–¥–∞—á–∞'];\n  let date = item.json['–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞'];\n  let time = item.json['–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞'];\n  let funnel = item.json['–í–æ—Ä–æ–Ω–∫–∞'];\n  const masterAppointed = item.json['–ú–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω'];\n  let cost = '';\n  let additionalMaterials = '';\n  let comment = '';\n  let photo = '';\n  let showAdditionalInfo = false;\n\n  if (funnel === \"6. —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É\") {\n      date = item.json['–î–∞—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n      time = item.json['–í—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n      description = item.json['–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç'];\n      cost = item.json['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç'] || \"–ù–µ—Ç\";\n      additionalMaterials = item.json['–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã'] || \"–ù–µ—Ç\";\n      comment = item.json['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] || \"–ù–µ—Ç\";\n      photo = item.json['–§–æ—Ç–æ'] || \"–ù–µ—Ç\";\n  } else if (funnel === \"7. –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª\" || funnel === \"10. –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É\") {\n      cost = item.json['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç'] || \"–ù–µ—Ç\";\n      additionalMaterials = item.json['–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã'] || \"–ù–µ—Ç\";\n      comment = item.json['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] || \"–ù–µ—Ç\";\n      photo = item.json['–§–æ—Ç–æ'] || \"–ù–µ—Ç\";\n      showAdditionalInfo = true;\n  }\n\n  if (funnel.startsWith('4.')) {\n    funnel = 'üìù –º–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω';\n  } else if (funnel.startsWith('5.')) {\n    funnel = 'üö∂ 1—ã–π –≤–∏–∑–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω';\n  } else if (funnel.startsWith('6.')) {\n    funnel = 'üí≥ —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É';\n  } else if (funnel.startsWith('7.')) {\n    funnel = '‚úÖ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª';\n  } else if (funnel.startsWith('10.')) {\n    funnel = 'üîß –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É';\n  }\n\n  aggregatedText += `‚û§ <b>–ó–∞—è–≤–∫–∞ ‚Ññ${rowNumber}</b>\\n\\n`;\n  aggregatedText += `‚Ä¢ üë§<b>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</b> <i>${specialist}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÉ<b>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç:</b> <i>${description}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÖ<b>–î–∞—Ç–∞:</b> <i>${date}</i>\\n`;\n  aggregatedText += `‚Ä¢ üï∞<b>–í—Ä–µ–º—è:</b> <i>${time}</i>\\n`;\n  aggregatedText += `‚Ä¢ üõ† <b>–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏:</b> <i>${funnel}</i>\\n`;\n\n  if (cost) {\n    aggregatedText += `‚Ä¢ üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç:</b> <i>${cost}</i>\\n`;\n  }\n  \n  if (additionalMaterials) {\n    aggregatedText += `‚Ä¢ üõí <b>–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã:</b> <i>${additionalMaterials}</i>\\n`;\n  }\n  \n  if (comment) {\n    aggregatedText += `‚Ä¢ üí¨ <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b> <i>${comment}</i>\\n`;\n  }\n  \n  if (photo) {\n    aggregatedText += `‚Ä¢ üì∑ <b>–§–æ—Ç–æ:</b> <i>${photo}</i>\\n`;\n  }\n\n  if (showAdditionalInfo && masterAppointed) {\n    aggregatedText += `‚Ä¢ üß∞ <b>–ú–∞—Å—Ç–µ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</b><i>üëã ${masterAppointed}</i>\\n`;\n  } else if (masterAppointed) {\n    aggregatedText += `‚Ä¢ üß∞ <b>–í–∞–º –Ω–∞–∑–Ω–∞—á–µ–Ω –º–∞—Å—Ç–µ—Ä: </b><i>üëã ${masterAppointed}</i>\\n`;\n  }\n\n  aggregatedText += '\\n';\n});\n\nreturn [{json: {aggregatedText: aggregatedText}}];"},"id":"126215f2-5c5f-413d-b329-9874c9910575","name":"—Ç–µ–∫—Å—Ç4","type":"n8n-nodes-base.code","typeVersion":1,"position":[380,-300]},{"parameters":{"content":"–°–¢–ê–¢–£–° –ó–ê–Ø–í–ö–ò –ú–ê–°–¢–ï–† –ù–ê–ó–ù–ê–ß–ï–ù","height":212.46577720086336,"width":427.3777757173698},"id":"e5457c16-26a5-49aa-a878-c514b560538c","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1200,180.03911177044188]},{"parameters":{"content":"–°–¢–ê–¢–£–° –ó–ê–Ø–í–ö–ò –ü–ï–†–í–´–ô –í–ò–ó–ò–¢ –ó–ê–í–ï–†–®–ï–ù","height":217.46251788665987,"width":434.87288674606447},"id":"d1f5cda1-4fc7-4f2e-95f8-ab51781bee09","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1200,422.53748211333993]},{"parameters":{"content":"–°–¢–ê–¢–£–° –ó–ê–Ø–í–ö–ò –ö–õ–ò–ï–ù–¢ –û–¢–ü–†–ê–í–ò–õ –ù–ê –î–û–†–ê–ë–û–¢–ö–£","height":214.9641475437616,"width":439.8696274318605},"id":"20f1795c-90c5-4c3d-91c8-2813505a7b62","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1200,665.0358524562381]},{"parameters":{"content":"–°–¢–ê–¢–£–° –ó–ê–Ø–í–ö–ò –ö–õ–ò–ï–ù–¢ –ü–û–î–¢–í–ï–†–î–ò–õ","height":204.9706661721686,"width":447.3647384605555},"id":"50a130ba-d8ed-4dd2-a22d-7362f759793c","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1200,895.0293338278315]},{"parameters":{"jsCode":"let aggregatedText = '';\n\nitems.forEach(item => {\n  const rowNumber = item.json.row_number;\n  const specialist = item.json['–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'];\n  let description = item.json['–ó–∞–¥–∞—á–∞'];\n  let date = item.json['–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞'];\n  let time = item.json['–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞'];\n  let funnel = item.json['–í–æ—Ä–æ–Ω–∫–∞'];\n  const masterAppointed = item.json['–ú–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω'];\n  let cost = '';\n  let additionalMaterials = '';\n  let comment = '';\n  let photo = '';\n  let showAdditionalInfo = false;\n\n  if (funnel === \"6. —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É\") {\n      date = item.json['–î–∞—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n      time = item.json['–í—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n      description = item.json['–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç'];\n      cost = item.json['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç'] || \"–ù–µ—Ç\";\n      additionalMaterials = item.json['–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã'] || \"–ù–µ—Ç\";\n      comment = item.json['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] || \"–ù–µ—Ç\";\n      photo = item.json['–§–æ—Ç–æ'] || \"–ù–µ—Ç\";\n  } else if (funnel === \"7. –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª\" || funnel === \"10. –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É\") {\n      cost = item.json['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç'] || \"–ù–µ—Ç\";\n      additionalMaterials = item.json['–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã'] || \"–ù–µ—Ç\";\n      comment = item.json['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] || \"–ù–µ—Ç\";\n      photo = item.json['–§–æ—Ç–æ'] || \"–ù–µ—Ç\";\n      showAdditionalInfo = true;\n  }\n\n  if (funnel.startsWith('4.')) {\n    funnel = 'üìù –º–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω';\n  } else if (funnel.startsWith('5.')) {\n    funnel = 'üö∂ 1—ã–π –≤–∏–∑–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω';\n  } else if (funnel.startsWith('6.')) {\n    funnel = 'üí≥ —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É';\n  } else if (funnel.startsWith('7.')) {\n    funnel = '‚úÖ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª';\n  } else if (funnel.startsWith('10.')) {\n    funnel = 'üîß –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É';\n  }\n\n  aggregatedText += `‚û§ <b>–ó–∞—è–≤–∫–∞ ‚Ññ${rowNumber}</b>\\n\\n`;\n  aggregatedText += `‚Ä¢ üë§<b>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</b> <i>${specialist}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÉ<b>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç:</b> <i>${description}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÖ<b>–î–∞—Ç–∞:</b> <i>${date}</i>\\n`;\n  aggregatedText += `‚Ä¢ üï∞<b>–í—Ä–µ–º—è:</b> <i>${time}</i>\\n`;\n  aggregatedText += `‚Ä¢ üõ† <b>–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏:</b> <i>${funnel}</i>\\n`;\n\n  if (cost) {\n    aggregatedText += `‚Ä¢ üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç:</b> <i>${cost}</i>\\n`;\n  }\n  \n  if (additionalMaterials) {\n    aggregatedText += `‚Ä¢ üõí <b>–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã:</b> <i>${additionalMaterials}</i>\\n`;\n  }\n  \n  if (comment) {\n    aggregatedText += `‚Ä¢ üí¨ <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b> <i>${comment}</i>\\n`;\n  }\n  \n  if (photo) {\n    aggregatedText += `‚Ä¢ üì∑ <b>–§–æ—Ç–æ:</b> <i>${photo}</i>\\n`;\n  }\n\n  if (showAdditionalInfo && masterAppointed) {\n    aggregatedText += `‚Ä¢ üß∞ <b>–ú–∞—Å—Ç–µ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</b><i>üëã ${masterAppointed}</i>\\n`;\n  } else if (masterAppointed) {\n    aggregatedText += `‚Ä¢ üß∞ <b>–í–∞–º –Ω–∞–∑–Ω–∞—á–µ–Ω –º–∞—Å—Ç–µ—Ä: </b><i>üëã ${masterAppointed}</i>\\n`;\n  }\n\n  aggregatedText += '\\n';\n});\n\nreturn [{json: {aggregatedText: aggregatedText}}];"},"id":"78878a59-ae3f-419f-b6db-ddd19573785c","name":"—Ç–µ–∫—Å—Ç5","type":"n8n-nodes-base.code","typeVersion":1,"position":[800,500]},{"parameters":{"jsCode":"let aggregatedText = '';\nlet numRequests = 0;\n\nitems.forEach(item => {\n  const rowNumber = item.json.row_number;\n  const specialist = item.json['–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'];\n  let description = item.json['–ó–∞–¥–∞—á–∞'];\n  let date = item.json['–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞'];\n  let time = item.json['–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞'];\n  let funnel = item.json['–í–æ—Ä–æ–Ω–∫–∞'];\n  const masterAppointed = item.json['–ú–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω'];\n  let cost = '';\n  let additionalMaterials = '';\n  let comment = '';\n  let photo = '';\n  let showAdditionalInfo = false;\n\n  if (funnel === \"6. —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É\") {\n      date = item.json['–î–∞—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n      time = item.json['–í—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è'];\n      description = item.json['–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç'];\n      cost = item.json['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç'] || \"–ù–µ—Ç\";\n      additionalMaterials = item.json['–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã'] || \"–ù–µ—Ç\";\n      comment = item.json['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] || \"–ù–µ—Ç\";\n      photo = item.json['–§–æ—Ç–æ'] || \"–ù–µ—Ç\";\n  } else if (funnel === \"7. –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª\" || funnel === \"10. –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É\") {\n      cost = item.json['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç'] || \"–ù–µ—Ç\";\n      additionalMaterials = item.json['–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã'] || \"–ù–µ—Ç\";\n      comment = item.json['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] || \"–ù–µ—Ç\";\n      photo = item.json['–§–æ—Ç–æ'] || \"–ù–µ—Ç\";\n      showAdditionalInfo = true;\n  }\n\n  if (funnel.startsWith('4.')) {\n    funnel = 'üìù –º–∞—Å—Ç–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω';\n  } else if (funnel.startsWith('5.')) {\n    funnel = 'üö∂ 1—ã–π –≤–∏–∑–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω';\n  } else if (funnel.startsWith('6.')) {\n    funnel = 'üí≥ —Ü–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É';\n  } else if (funnel.startsWith('7.')) {\n    funnel = '‚úÖ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª';\n  } else if (funnel.startsWith('10.')) {\n    funnel = 'üîß –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É';\n  }\n\n  aggregatedText += `‚û§ <b>–ó–∞—è–≤–∫–∞ ‚Ññ${rowNumber}</b>\\n\\n`;\n  aggregatedText += `‚Ä¢ üë§<b>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</b> <i>${specialist || \"–ù–µ—Ç\"}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÉ<b>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç:</b> <i>${description || \"–ù–µ—Ç\"}</i>\\n`;\n  aggregatedText += `‚Ä¢ üìÖ<b>–î–∞—Ç–∞:</b> <i>${date || \"–ù–µ—Ç\"}</i>\\n`;\n  aggregatedText += `‚Ä¢ üï∞<b>–í—Ä–µ–º—è:</b> <i>${time || \"–ù–µ—Ç\"}</i>\\n`;\n  aggregatedText += `‚Ä¢ üõ† <b>–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏:</b> <i>${funnel}</i>\\n`;\n\n  if (cost) {\n    aggregatedText += `‚Ä¢ üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç:</b> <i>${cost}</i>\\n`;\n  }\n  \n  if (additionalMaterials) {\n    aggregatedText += `‚Ä¢ üõí <b>–î–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª—ã:</b> <i>${additionalMaterials}</i>\\n`;\n  }\n  \n  if (comment) {\n    aggregatedText += `‚Ä¢ üí¨ <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b> <i>${comment}</i>\\n`;\n  }\n  \n  if (photo) {\n    aggregatedText += `‚Ä¢ üì∑ <b>–§–æ—Ç–æ:</b> <i>${photo}</i>\\n`;\n  }\n\n  if (showAdditionalInfo && masterAppointed) {\n    aggregatedText += `‚Ä¢ üß∞ <b>–ú–∞—Å—Ç–µ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</b><i>üëã ${masterAppointed}</i>\\n`;\n  } else if (masterAppointed) {\n    aggregatedText += `‚Ä¢ üß∞ <b>–í–∞–º –Ω–∞–∑–Ω–∞—á–µ–Ω –º–∞—Å—Ç–µ—Ä: </b><i>üëã ${masterAppointed}</i>\\n\\n`;\n  }\n\n  aggregatedText += '\\n';\n  numRequests++;\n});\n\naggregatedText += `Ôºú <b>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫ –≤ —Ä–∞–±–æ—Ç–µ: ${numRequests} –∑–∞—è–≤–∫–∏</b> Ôºû`;\n\nreturn [{json: {aggregatedText: aggregatedText}}];"},"id":"9c56df3a-f2e6-4701-aa87-b683eebceb85","name":"—Ç–µ–∫—Å—Ç6","type":"n8n-nodes-base.code","typeVersion":1,"position":[680,160]}],"connections":{"Webhook":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Google Sheets1","type":"main","index":0}],[{"node":"Google Sheets2","type":"main","index":0}]]},"Google Sheets":{"main":[[{"node":"—Ñ–∏–ª—å—Ç—Ä –∑–∞—è–≤–æ–∫","type":"main","index":0}]]},"Google Sheets1":{"main":[[{"node":"Google Sheets","type":"main","index":0}]]},"—Ç–µ–∫—Å—Ç":{"main":[[{"node":"Merge","type":"main","index":0}]]},"–∫–Ω–æ–ø–∫–∏":{"main":[[{"node":"Merge","type":"main","index":1}]]},"IF":{"main":[[{"node":"Telegram2","type":"main","index":0}],[{"node":"—Ç–µ–∫—Å—Ç","type":"main","index":0},{"node":"–∫–Ω–æ–ø–∫–∏","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Telegram","type":"main","index":0}]]},"Telegram":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"—Ñ–∏–ª—å—Ç—Ä –∑–∞—è–≤–æ–∫":{"main":[[{"node":"IF","type":"main","index":0}]]},"Telegram2":{"main":[[{"node":"Telegram1","type":"main","index":0}]]},"Google Sheets2":{"main":[[{"node":"—Ç–µ–∫—Å—Ç1","type":"main","index":0}]]},"—Ç–µ–∫—Å—Ç1":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"Telegram4":{"main":[[{"node":"Telegram3","type":"main","index":0}]]},"Telegram5":{"main":[[{"node":"Telegram6","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"Telegram4","type":"main","index":0}],[{"node":"Telegram5","type":"main","index":0}],[{"node":"Telegram7","type":"main","index":0}],[{"node":"Telegram9","type":"main","index":0}]]},"Telegram7":{"main":[[{"node":"Telegram8","type":"main","index":0}]]},"Telegram9":{"main":[[{"node":"Telegram10","type":"main","index":0}]]}},"settings":{"saveManualExecutions":false,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"10"},"staticData":null,"meta":null,"pinData":{},"versionId":"cd5011cf-b5ad-440b-b8b3-c7cb6fc30e57","triggerCount":1,"tags":[]}